# APIå‚è€ƒ

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**   
- [config.py](file://common/config.py)
- [hajimi_king.py](file://app/hajimi_king.py)
- [github_client.py](file://utils/github_client.py)
- [file_manager.py](file://utils/file_manager.py)
- [Logger.py](file://common/Logger.py) - *åœ¨æœ€è¿‘çš„æäº¤ä¸­æ›´æ–°*
</cite>

## æ›´æ–°æ‘˜è¦
**å·²åšæ›´æ”¹**   
- æ›´æ–°äº†â€œå†…éƒ¨å‡½æ•°æ¥å£â€éƒ¨åˆ†ï¼Œæ–°å¢äº† `Logger` ç±»çš„å¤šä¸ªæ–¹æ³•è¯´æ˜
- æ·»åŠ äº†å¯¹ `Logger.py` æ–‡ä»¶çš„å¼•ç”¨ï¼Œä»¥åæ˜ æ—¥å¿—æ¨¡å—çš„é‡æ„
- ä¿®æ­£äº†æ–‡æ¡£ä¸­æœªæåŠçš„ `Logger` æ–°å¢æ–¹æ³•ï¼Œç¡®ä¿ä¸ä»£ç å®ç°ä¸€è‡´
- ç»´æŠ¤å¹¶æ›´æ–°äº†æ–‡æ¡£çº§å’Œç« èŠ‚çº§çš„æºæ–‡ä»¶å¼•ç”¨ç³»ç»Ÿ

## ç›®å½•
1. [APIå‚è€ƒ](#apiå‚è€ƒ)
2. [ç¯å¢ƒå˜é‡é…ç½®](#ç¯å¢ƒå˜é‡é…ç½®)
3. [å‘½ä»¤è¡Œå‚æ•°](#å‘½ä»¤è¡Œå‚æ•°)
4. [å‚æ•°ç»„åˆä½¿ç”¨ç¤ºä¾‹](#å‚æ•°ç»„åˆä½¿ç”¨ç¤ºä¾‹)
5. [å†…éƒ¨å‡½æ•°æ¥å£](#å†…éƒ¨å‡½æ•°æ¥å£)

## ç¯å¢ƒå˜é‡é…ç½®

æœ¬èŠ‚è¯¦ç»†åˆ—å‡º `config.py` æ–‡ä»¶ä¸­å®šä¹‰çš„æ‰€æœ‰å¯é…ç½®ç¯å¢ƒå˜é‡ï¼ŒåŒ…æ‹¬å…¶åç§°ã€æ•°æ®ç±»å‹ã€é»˜è®¤å€¼ã€å–å€¼èŒƒå›´å’ŒåŠŸèƒ½æè¿°ã€‚

**Section sources**
- [config.py](file://common/config.py#L12-L169)

### GitHub é…ç½®
| ç¯å¢ƒå˜é‡åç§° | æ•°æ®ç±»å‹ | é»˜è®¤å€¼ | å–å€¼èŒƒå›´ | åŠŸèƒ½æè¿° |
| --- | --- | --- | --- | --- |
| **GITHUB_TOKENS** | å­—ç¬¦ä¸²ï¼ˆé€—å·åˆ†éš”ï¼‰ | "" | ä»»æ„å­—ç¬¦ä¸² | ç”¨äºè®¿é—® GitHub API çš„ä¸ªäººè®¿é—®ä»¤ç‰Œåˆ—è¡¨ï¼Œå¤šä¸ªä»¤ç‰Œç”¨é€—å·åˆ†éš”ã€‚è¿™æ˜¯å¿…å¡«é¡¹ã€‚ |
| **PROXY** | å­—ç¬¦ä¸²ï¼ˆé€—å·åˆ†éš”ï¼‰ | "" | ä»»æ„å­—ç¬¦ä¸² | ç”¨äºè®¿é—® GitHub API çš„ä»£ç†æœåŠ¡å™¨åˆ—è¡¨ï¼Œæ”¯æŒ `http://` å’Œ `socks5://` æ ¼å¼ï¼Œå¤šä¸ªä»£ç†ç”¨é€—å·åˆ†éš”ã€‚ |

### æ•°æ®å­˜å‚¨é…ç½®
| ç¯å¢ƒå˜é‡åç§° | æ•°æ®ç±»å‹ | é»˜è®¤å€¼ | å–å€¼èŒƒå›´ | åŠŸèƒ½æè¿° |
| --- | --- | --- | --- | --- |
| **DATA_PATH** | å­—ç¬¦ä¸² | /app/data | ä»»æ„æœ‰æ•ˆè·¯å¾„ | åº”ç”¨ç¨‹åºç”¨äºå­˜å‚¨æ•°æ®æ–‡ä»¶ï¼ˆå¦‚æ—¥å¿—ã€æ£€æŸ¥ç‚¹ï¼‰çš„æ ¹ç›®å½•è·¯å¾„ã€‚ |

### æ–‡ä»¶è·¯å¾„ä¸å‰ç¼€é…ç½®
| ç¯å¢ƒå˜é‡åç§° | æ•°æ®ç±»å‹ | é»˜è®¤å€¼ | å–å€¼èŒƒå›´ | åŠŸèƒ½æè¿° |
| --- | --- | --- | --- | --- |
| **VALID_KEY_PREFIX** | å­—ç¬¦ä¸² | keys/keys_valid_ | ä»»æ„å­—ç¬¦ä¸² | å­˜å‚¨æœ‰æ•ˆ API å¯†é’¥çš„æ–‡ä»¶è·¯å¾„å‰ç¼€ã€‚ |
| **RATE_LIMITED_KEY_PREFIX** | å­—ç¬¦ä¸² | keys/key_429_ | ä»»æ„å­—ç¬¦ä¸² | å­˜å‚¨è¢«é™æµ API å¯†é’¥çš„æ–‡ä»¶è·¯å¾„å‰ç¼€ã€‚ |
| **VALID_KEY_DETAIL_PREFIX** | å­—ç¬¦ä¸² | logs/keys_valid_detail_ | ä»»æ„å­—ç¬¦ä¸² | å­˜å‚¨æœ‰æ•ˆå¯†é’¥è¯¦ç»†ä¿¡æ¯ï¼ˆå« URLï¼‰çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„å‰ç¼€ã€‚ |
| **RATE_LIMITED_KEY_DETAIL_PREFIX** | å­—ç¬¦ä¸² | logs/key_429_detail_ | ä»»æ„å­—ç¬¦ä¸² | å­˜å‚¨è¢«é™æµå¯†é’¥è¯¦ç»†ä¿¡æ¯çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„å‰ç¼€ã€‚ |
| **QUERIES_FILE** | å­—ç¬¦ä¸² | queries.txt | ä»»æ„æ–‡ä»¶å | åŒ…å« GitHub æœç´¢æŸ¥è¯¢è¯­å¥çš„æ–‡ä»¶åï¼ˆç›¸å¯¹äº `DATA_PATH`ï¼‰ã€‚ |
| **SCANNED_SHAS_FILE** | å­—ç¬¦ä¸² | scanned_shas.txt | ä»»æ„æ–‡ä»¶å | ç”¨äºè®°å½•å·²æ‰«ææ–‡ä»¶ SHA å€¼çš„æ–‡ä»¶åï¼ˆç›¸å¯¹äº `DATA_PATH`ï¼‰ã€‚ |

### æœç´¢ä¸è¿‡æ»¤é…ç½®
| ç¯å¢ƒå˜é‡åç§° | æ•°æ®ç±»å‹ | é»˜è®¤å€¼ | å–å€¼èŒƒå›´ | åŠŸèƒ½æè¿° |
| --- | --- | --- | --- | --- |
| **DATE_RANGE_DAYS** | æ•´æ•° | 730 | å¤§äº 0 çš„æ•´æ•° | ç”¨äºè¿‡æ»¤ä»“åº“çš„å¹´é¾„èŒƒå›´ï¼ˆå¤©ï¼‰ï¼Œåªæœç´¢åœ¨æ­¤å¤©æ•°å†…æœ‰æ›´æ–°çš„ä»“åº“ã€‚ |
| **FILE_PATH_BLACKLIST** | å­—ç¬¦ä¸²ï¼ˆé€—å·åˆ†éš”ï¼‰ | readme,docs,doc/,.md,sample,tutorial | ä»»æ„å­—ç¬¦ä¸² | æ–‡ä»¶è·¯å¾„é»‘åå•ï¼ŒåŒ…å«è¿™äº›å…³é”®è¯çš„æ–‡ä»¶è·¯å¾„å°†è¢«è·³è¿‡ã€‚ |
| **HAJIMI_CHECK_MODEL** | å­—ç¬¦ä¸² | gemini-2.5-flash | ä»»æ„æ¨¡å‹åç§° | ç”¨äºéªŒè¯ Google API å¯†é’¥çš„ Gemini æ¨¡å‹åç§°ã€‚ |

### ModelScope å¯†é’¥æå–é…ç½®
| ç¯å¢ƒå˜é‡åç§° | æ•°æ®ç±»å‹ | é»˜è®¤å€¼ | å–å€¼èŒƒå›´ | åŠŸèƒ½æè¿° |
| --- | --- | --- | --- | --- |
| **TARGET_BASE_URLS** | å­—ç¬¦ä¸²ï¼ˆé€—å·åˆ†éš”ï¼‰ | https://api-inference.modelscope.cn/v1/ | æœ‰æ•ˆçš„ URL | ç›®æ ‡ API åŸºç¡€ URL åˆ—è¡¨ï¼Œç”¨äºè¯†åˆ«åŒ…å« ModelScope å¯†é’¥çš„æ–‡ä»¶ã€‚ |
| **MS_USE_LOOSE_PATTERN** | å­—ç¬¦ä¸²ï¼ˆå¸ƒå°”å€¼ï¼‰ | false | true, false | æ˜¯å¦ä½¿ç”¨å®½æ¾çš„å¯†é’¥æ¨¡å¼ï¼ˆ`ms-`åè·Ÿé•¿å­—ç¬¦ä¸²ï¼‰è¿›è¡ŒåŒ¹é…ã€‚ |
| **MS_PROXIMITY_CHARS** | æ•´æ•° | 0 | å¤§äºç­‰äº 0 çš„æ•´æ•° | å½“ä½¿ç”¨å®½æ¾æ¨¡å¼æ—¶ï¼Œå¯†é’¥ä¸ `TARGET_BASE_URLS` åœ¨æ–‡æœ¬ä¸­çš„æœ€å¤§å­—ç¬¦è·ç¦»ã€‚ |
| **MS_REQUIRE_KEY_CONTEXT** | å­—ç¬¦ä¸²ï¼ˆå¸ƒå°”å€¼ï¼‰ | false | true, false | æ˜¯å¦è¦æ±‚å¯†é’¥å‘¨å›´å­˜åœ¨ "key", "token" ç­‰ä¸Šä¸‹æ–‡å…³é”®è¯ã€‚ |
| **MODELSCOPE_EXTRACT_ONLY** | å­—ç¬¦ä¸²ï¼ˆå¸ƒå°”å€¼ï¼‰ | true | true, false | æ˜¯å¦ä»…æå– ModelScope å¯†é’¥ï¼Œä¸è¿›è¡Œå¤–éƒ¨éªŒè¯ã€‚ |

### OpenRouter å¯†é’¥æå–é…ç½®
| ç¯å¢ƒå˜é‡åç§° | æ•°æ®ç±»å‹ | é»˜è®¤å€¼ | å–å€¼èŒƒå›´ | åŠŸèƒ½æè¿° |
| --- | --- | --- | --- | --- |
| **OPENROUTER_BASE_URLS** | å­—ç¬¦ä¸²ï¼ˆé€—å·åˆ†éš”ï¼‰ | https://openrouter.ai/api/v1 | æœ‰æ•ˆçš„ URL | OpenRouter API åŸºç¡€ URL åˆ—è¡¨ï¼Œç”¨äºè¯†åˆ«åŒ…å« OpenRouter å¯†é’¥çš„æ–‡ä»¶ã€‚ |
| **OPENROUTER_USE_LOOSE_PATTERN** | å­—ç¬¦ä¸²ï¼ˆå¸ƒå°”å€¼ï¼‰ | false | true, false | æ˜¯å¦ä½¿ç”¨å®½æ¾æ¨¡å¼åŒ¹é… OpenRouter å¯†é’¥ã€‚ |
| **OPENROUTER_PROXIMITY_CHARS** | æ•´æ•° | 0 | å¤§äºç­‰äº 0 çš„æ•´æ•° | å¯†é’¥ä¸ `OPENROUTER_BASE_URLS` åœ¨æ–‡æœ¬ä¸­çš„æœ€å¤§å­—ç¬¦è·ç¦»ã€‚ |
| **OPENROUTER_REQUIRE_KEY_CONTEXT** | å­—ç¬¦ä¸²ï¼ˆå¸ƒå°”å€¼ï¼‰ | false | true, false | æ˜¯å¦è¦æ±‚å¯†é’¥å‘¨å›´å­˜åœ¨ä¸Šä¸‹æ–‡å…³é”®è¯ã€‚ |
| **OPENROUTER_EXTRACT_ONLY** | å­—ç¬¦ä¸²ï¼ˆå¸ƒå°”å€¼ï¼‰ | true | true, false | æ˜¯å¦ä»…æå– OpenRouter å¯†é’¥ï¼Œä¸è¿›è¡Œå¤–éƒ¨éªŒè¯ã€‚ |

## å‘½ä»¤è¡Œå‚æ•°

`hajimi_king.py` æ”¯æŒä»¥ä¸‹å‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨äºæ§åˆ¶ç¨‹åºçš„è¿è¡Œæ¨¡å¼ã€‚

**Section sources**
- [hajimi_king.py](file://app/hajimi_king.py#L24-L30)

### --mode
*   **è¯­æ³•**: `--mode {modelscope-only,compatible}`
*   **å‚æ•°ç±»å‹**: å­—ç¬¦ä¸²ï¼ˆæšä¸¾ï¼‰
*   **ä½¿ç”¨åœºæ™¯**: æ§åˆ¶å¯†é’¥æå–çš„æ¨¡å¼ã€‚
    *   `modelscope-only`: ä»…æå–ç¬¦åˆ `ms-UUID` æ¨¡å¼çš„ ModelScope å¯†é’¥ï¼Œä¸è¿›è¡Œä»»ä½•å¤–éƒ¨éªŒè¯ï¼Œå¹¶ä¸”ä¸ä¼šå›é€€åˆ°åŸæœ‰çš„ Google API å¯†é’¥æå–é€»è¾‘ã€‚
    *   `compatible`: é¦–å…ˆå°è¯•æå– ModelScope å¯†é’¥ï¼Œå¦‚æœæœªæ‰¾åˆ°ï¼Œåˆ™å›é€€åˆ°åŸæœ‰çš„ Google API å¯†é’¥æå–å’ŒéªŒè¯é€»è¾‘ã€‚
*   **ä¾èµ–å…³ç³»**: æ­¤å‚æ•°ä¼šè¦†ç›–ç¯å¢ƒå˜é‡ `MODELSCOPE_EXTRACT_ONLY` çš„å€¼ï¼Œä½†ä»…åœ¨å½“å‰è¿›ç¨‹è¿è¡ŒæœŸé—´æœ‰æ•ˆã€‚

## å‚æ•°ç»„åˆä½¿ç”¨ç¤ºä¾‹

ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ç»„åˆä½¿ç”¨ç¯å¢ƒå˜é‡å’Œå‘½ä»¤è¡Œå‚æ•°ã€‚

### ç¤ºä¾‹ 1ï¼šå¯ç”¨è°ƒè¯•æ¨¡å¼
é€šè¿‡è®¾ç½® `DEBUG` ç¯å¢ƒå˜é‡ï¼ˆè™½ç„¶ä»£ç ä¸­æœªç›´æ¥ä½¿ç”¨ï¼Œä½†å¯é€šè¿‡æ—¥å¿—çº§åˆ«æ§åˆ¶ï¼‰å’Œ `MODELSCOPE_EXTRACT_ONLY=false` æ¥å¯ç”¨æ›´è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºå’Œå®Œæ•´çš„éªŒè¯æµç¨‹ã€‚
```bash
export MODELSCOPE_EXTRACT_ONLY=false
python app/hajimi_king.py --mode compatible
```

### ç¤ºä¾‹ 2ï¼šæŒ‡å®šè‡ªå®šä¹‰é…ç½®è·¯å¾„
é€šè¿‡è®¾ç½® `DATA_PATH` ç¯å¢ƒå˜é‡æ¥æŒ‡å®šæ•°æ®æ–‡ä»¶çš„å­˜å‚¨ä½ç½®ã€‚
```bash
export DATA_PATH=/custom/data/path
export QUERIES_FILE=my_queries.txt
python app/hajimi_king.py
```

### ç¤ºä¾‹ 3ï¼šä»…æå– ModelScope å¯†é’¥
ä½¿ç”¨ `--mode modelscope-only` å‚æ•°æ¥ä»…æå– ModelScope å¯†é’¥ï¼Œå¿½ç•¥æ‰€æœ‰å…¶ä»–å¯†é’¥ã€‚
```bash
python app/hajimi_king.py --mode modelscope-only
```

## å†…éƒ¨å‡½æ•°æ¥å£

æœ¬èŠ‚æä¾›å…³é”®å†…éƒ¨å‡½æ•°çš„ç®€è¦è¯´æ˜ï¼Œä¸ºè‡ªåŠ¨åŒ–è„šæœ¬ç¼–å†™è€…å’Œç³»ç»Ÿé›†æˆè€…æä¾›æŠ€æœ¯å‚è€ƒã€‚

**Section sources**
- [github_client.py](file://utils/github_client.py#L30-L150)
- [Logger.py](file://common/Logger.py#L10-L180) - *æ–°å¢æ—¥å¿—æ–¹æ³•*

### github_client.GitHubClient.search_for_keys()
*   **æ–¹æ³•ç­¾å**: `search_for_keys(self, query: str, max_retries: int = 5) -> Dict[str, Any]`
*   **åŠŸèƒ½æè¿°**: ä½¿ç”¨é…ç½®çš„ GitHub ä»¤ç‰Œåœ¨ GitHub ä»£ç ä¸­æ‰§è¡Œæœç´¢æŸ¥è¯¢ã€‚å®ƒä¼šè‡ªåŠ¨è½®æ¢ä»¤ç‰Œä»¥é¿å…é€Ÿç‡é™åˆ¶ï¼Œå¹¶å¤„ç†åˆ†é¡µï¼Œæœ€å¤šè¿”å› 1000 ä¸ªç»“æœã€‚
*   **è¿”å›ç»“æ„**: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å« `total_count` (æ€»ç»“æœæ•°), `incomplete_results` (å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºç»“æœæ˜¯å¦ä¸å®Œæ•´), å’Œ `items` (åŒ…å«æœç´¢ç»“æœçš„åˆ—è¡¨)ã€‚

### github_client.GitHubClient.get_file_content()
*   **æ–¹æ³•ç­¾å**: `get_file_content(self, item: Dict[str, Any]) -> Optional[str]`
*   **åŠŸèƒ½æè¿°**: æ ¹æ® GitHub æœç´¢ç»“æœé¡¹è·å–æ–‡ä»¶çš„å®Œæ•´å†…å®¹ã€‚å®ƒä¼šå¤„ç† base64 ç¼–ç çš„å†…å®¹ï¼Œå¹¶åœ¨å¿…è¦æ—¶é€šè¿‡ `download_url` è·å–ã€‚
*   **è¿”å›ç»“æ„**: æˆåŠŸæ—¶è¿”å›æ–‡ä»¶å†…å®¹çš„å­—ç¬¦ä¸²ï¼Œå¤±è´¥æ—¶è¿”å› `None`ã€‚

### common.Logger.Logger.success()
*   **æ–¹æ³•ç­¾å**: `success(self, message: str, *args, **kwargs)`
*   **åŠŸèƒ½æè¿°**: è®°å½•æˆåŠŸæ¶ˆæ¯ï¼Œä½¿ç”¨ç‰¹æ®Šå›¾æ ‡ âœ… å’Œ INFO çº§åˆ«ï¼Œç”¨äºæ ‡è¯†æ“ä½œæˆåŠŸã€‚
*   **è¿”å›ç»“æ„**: æ— 

### common.Logger.Logger.progress()
*   **æ–¹æ³•ç­¾å**: `progress(self, message: str, current: int, total: int, *args, **kwargs)`
*   **åŠŸèƒ½æè¿°**: è®°å½•è¿›åº¦ä¿¡æ¯ï¼Œæ˜¾ç¤ºè¿›åº¦æ¡ã€ç™¾åˆ†æ¯”å’Œå½“å‰/æ€»æ•°ï¼Œç”¨äºé•¿æ—¶é—´è¿è¡Œä»»åŠ¡çš„å¯è§†åŒ–è¿›åº¦ã€‚
*   **è¿”å›ç»“æ„**: æ— 

### common.Logger.Logger.network()
*   **æ–¹æ³•ç­¾å**: `network(self, message: str, *args, **kwargs)`
*   **åŠŸèƒ½æè¿°**: è®°å½•ç½‘ç»œç›¸å…³æ“ä½œï¼Œä½¿ç”¨ ğŸŒ å›¾æ ‡ï¼Œç”¨äºæ ‡è¯†ç½‘ç»œè¯·æ±‚æˆ–è¿æ¥äº‹ä»¶ã€‚
*   **è¿”å›ç»“æ„**: æ— 

### common.Logger.Logger.file_op()
*   **æ–¹æ³•ç­¾å**: `file_op(self, message: str, *args, **kwargs)`
*   **åŠŸèƒ½æè¿°**: è®°å½•æ–‡ä»¶æ“ä½œï¼Œä½¿ç”¨ ğŸ“ å›¾æ ‡ï¼Œç”¨äºæ ‡è¯†æ–‡ä»¶è¯»å†™ã€åˆ›å»ºæˆ–åˆ é™¤ç­‰æ“ä½œã€‚
*   **è¿”å›ç»“æ„**: æ— 

### common.Logger.Logger.security()
*   **æ–¹æ³•ç­¾å**: `security(self, message: str, *args, **kwargs)`
*   **åŠŸèƒ½æè¿°**: è®°å½•å®‰å…¨ç›¸å…³äº‹ä»¶ï¼Œä½¿ç”¨ ğŸ”’ å›¾æ ‡å’Œ WARNING çº§åˆ«ï¼Œç”¨äºæ ‡è¯†æ½œåœ¨çš„å®‰å…¨é£é™©æˆ–æ•æ„Ÿæ“ä½œã€‚
*   **è¿”å›ç»“æ„**: æ— 

### common.Logger.Logger.rate_limit()
*   **æ–¹æ³•ç­¾å**: `rate_limit(self, message: str, *args, **kwargs)`
*   **åŠŸèƒ½æè¿°**: è®°å½•é¢‘ç‡é™åˆ¶äº‹ä»¶ï¼Œä½¿ç”¨ â±ï¸ å›¾æ ‡å’Œ WARNING çº§åˆ«ï¼Œç”¨äºæ ‡è¯† API è°ƒç”¨è¢«é™æµçš„æƒ…å†µã€‚
*   **è¿”å›ç»“æ„**: æ— 

### common.Logger.Logger.separator()
*   **æ–¹æ³•ç­¾å**: `separator(self, title: str = "", char: str = "=", width: int = 60)`
*   **åŠŸèƒ½æè¿°**: æ‰“å°åˆ†éš”çº¿ï¼Œå¯å¸¦æ ‡é¢˜ï¼Œç”¨äºåœ¨æ—¥å¿—ä¸­åˆ’åˆ†ä¸åŒé€»è¾‘å—ï¼Œæé«˜å¯è¯»æ€§ã€‚
*   **è¿”å›ç»“æ„**: æ— 