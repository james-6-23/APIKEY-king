# æ–‡ä»¶ä¸çŠ¶æ€ç®¡ç†æ¨¡å—

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**  
- [file_manager.py](file://src\services\file_service.py) - *å·²é‡æ„ä¸ºæ–‡ä»¶æœåŠ¡æ¨¡å—*
- [config.py](file://src\models\config.py) - *é…ç½®æ¨¡å‹æ›´æ–°*
- [scanner.py](file://src\core\scanner.py) - *æ ¸å¿ƒæ‰«æå™¨é€»è¾‘*
- [__init__.py](file://src\models\__init__.py) - *æ–°å¢Checkpointæ•°æ®æ¨¡å‹*
</cite>

## æ›´æ–°æ‘˜è¦
**å˜æ›´å†…å®¹**  
- é¡¹ç›®ç»“æ„é‡æ„ï¼ŒåŸ `utils/file_manager.py` å·²è¿ç§»è‡³ `src/services/file_service.py`
- `Checkpoint` ç±»ä»å·¥å…·æ¨¡å—ç§»è‡³ `src/models/__init__.py`ï¼Œä½œä¸ºæ ¸å¿ƒæ•°æ®æ¨¡å‹ç»Ÿä¸€ç®¡ç†
- æ–°å¢ `ScanResult` å’Œ `BatchScanResult` æ•°æ®ç±»ï¼Œå®Œå–„æ‰«æç»“æœçš„æ•°æ®ç»“æ„ä½“ç³»
- é…ç½®ç®¡ç†æ¨¡å—è¿ç§»è‡³ `src/models/config.py`ï¼Œå®ç°æ¨¡å‹ä¸é…ç½®åˆ†ç¦»
- æ‰€æœ‰çŠ¶æ€ç®¡ç†ç›¸å…³åŠŸèƒ½ç°ç”± `file_service` ç»Ÿä¸€æä¾›æœåŠ¡æ¥å£

## ç›®å½•
1. [é¡¹ç›®ç»“æ„åˆ†æ](#é¡¹ç›®ç»“æ„åˆ†æ)  
2. [æ ¸å¿ƒåŠŸèƒ½æ¦‚è¿°](#æ ¸å¿ƒåŠŸèƒ½æ¦‚è¿°)  
3. [Checkpointç±»è®¾è®¡ä¸åºåˆ—åŒ–æœºåˆ¶](#checkpointç±»è®¾è®¡ä¸åºåˆ—åŒ–æœºåˆ¶)  
4. [æ–‡ä»¶ç®¡ç†å™¨ï¼ˆFileManagerï¼‰æ ¸å¿ƒé€»è¾‘](#æ–‡ä»¶ç®¡ç†å™¨filemanageræ ¸å¿ƒé€»è¾‘)  
5. [å¢é‡æ‰«æä¸çŠ¶æ€æ›´æ–°ç­–ç•¥](#å¢é‡æ‰«æä¸çŠ¶æ€æ›´æ–°ç­–ç•¥)  
6. [æ–‡ä»¶è¯»å†™å®‰å…¨ä¸å¼‚å¸¸å¤„ç†](#æ–‡ä»¶è¯»å†™å®‰å…¨ä¸å¼‚å¸¸å¤„ç†)  
7. [å®é™…åº”ç”¨åœºæ™¯åˆ†æ](#å®é™…åº”ç”¨åœºæ™¯åˆ†æ)  
8. [æ€»ç»“](#æ€»ç»“)

## é¡¹ç›®ç»“æ„åˆ†æ

æœ¬é¡¹ç›®å·²å®Œæˆæ¨¡å—åŒ–é‡æ„ï¼Œä¸»è¦ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

- `src/core/`ï¼šæ ¸å¿ƒæ‰«æé€»è¾‘ï¼ŒåŒ…å«æ‰«æå™¨å®ç°ã€‚
- `src/models/`ï¼šæ•°æ®æ¨¡å‹å®šä¹‰ï¼ŒåŒ…æ‹¬æ£€æŸ¥ç‚¹ã€æ‰«æç»“æœç­‰ã€‚
- `src/services/`ï¼šä¸šåŠ¡æœåŠ¡å±‚ï¼Œæä¾›æ–‡ä»¶æ“ä½œã€é…ç½®ç®¡ç†ç­‰æœåŠ¡ã€‚
- `src/extractors/`ï¼šå¯†é’¥æå–å™¨å®ç°ã€‚
- `src/validators/`ï¼šå¯†é’¥éªŒè¯å™¨å®ç°ã€‚

å…¶ä¸­ï¼Œ`src/models/__init__.py` å®šä¹‰äº† `Checkpoint`ã€`ScanResult` å’Œ `BatchScanResult` ç­‰æ ¸å¿ƒæ•°æ®æ¨¡å‹ï¼Œè€Œæ–‡ä»¶æŒä¹…åŒ–æ“ä½œç”± `src/services/file_service.py` ç»Ÿä¸€å¤„ç†ã€‚

```mermaid
graph TD
A[file_service.py] --> B[Checkpoint]
A --> C[ScanResult]
A --> D[BatchScanResult]
E[config.py] --> A
F[scanner.py] --> A
F --> E
C --> G[checkpoint.json]
C --> H[scanned_shas.txt]
C --> I[keys_valid_*.txt]
C --> J[key_429_*.txt]
```

**å›¾ç¤ºæ¥æº**  
- [file_service.py](file://src\services\file_service.py)
- [config.py](file://src\models\config.py)

**æœ¬èŠ‚æ¥æº**  
- [file_service.py](file://src\services\file_service.py)
- [models/__init__.py](file://src\models\__init__.py)

## æ ¸å¿ƒåŠŸèƒ½æ¦‚è¿°

`src/services/file_service.py` æ¨¡å—çš„æ ¸å¿ƒèŒè´£æ˜¯å®ç°**æ–­ç‚¹ç»­ä¼ **å’Œ**çŠ¶æ€æŒä¹…åŒ–**ã€‚é€šè¿‡å°†æ‰«æçŠ¶æ€ä¿å­˜åˆ°ç£ç›˜æ–‡ä»¶ä¸­ï¼Œç³»ç»Ÿåœ¨é‡å¯åå¯ä»¥æ¢å¤ä¸Šæ¬¡çš„æ‰«æè¿›åº¦ï¼Œé¿å…é‡å¤å·¥ä½œã€‚è¯¥æ¨¡å—ä¸»è¦ä¾èµ–äº `src/models/__init__.py` ä¸­å®šä¹‰çš„æ•°æ®æ¨¡å‹ï¼Œä¸»è¦åŒ…æ‹¬ï¼š

- `Checkpoint`ï¼šå®šä¹‰æ‰«æçŠ¶æ€çš„æ•°æ®ç»“æ„ã€‚
- `ScanResult`ï¼šå•ä¸ªæ–‡ä»¶æ‰«æç»“æœçš„æ•°æ®ç»“æ„ã€‚
- `BatchScanResult`ï¼šæ‰¹é‡æ‰«æç»“æœçš„èšåˆç»“æ„ã€‚
- `file_service`ï¼šæä¾›æ–‡ä»¶è¯»å†™ã€æ£€æŸ¥ç‚¹ç®¡ç†ç­‰æœåŠ¡æ¥å£ã€‚

æ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š
1. å¯åŠ¨æ—¶ä»ç£ç›˜åŠ è½½ `checkpoint.json` å’Œ `scanned_shas.txt`ã€‚
2. æ‰§è¡Œæ‰«æä»»åŠ¡ï¼Œè¿‡ç¨‹ä¸­åŠ¨æ€æ›´æ–°å†…å­˜ä¸­çš„ `Checkpoint` å¯¹è±¡ã€‚
3. å®šæœŸå°†çŠ¶æ€å†™å›ç£ç›˜ï¼Œç¡®ä¿æ•°æ®ä¸ä¸¢å¤±ã€‚
4. ç¨‹åºé€€å‡ºæˆ–å¼‚å¸¸ä¸­æ–­åï¼Œä¸‹æ¬¡å¯åŠ¨å¯è‡ªåŠ¨æ¢å¤ã€‚

**æœ¬èŠ‚æ¥æº**  
- [file_service.py](file://src\services\file_service.py)
- [models/__init__.py](file://src\models\__init__.py)

## Checkpointç±»è®¾è®¡ä¸åºåˆ—åŒ–æœºåˆ¶

`Checkpoint` ç±»ä½¿ç”¨ Python çš„ `dataclass` å®ç°ï¼Œå°è£…äº†æ‰«æè¿‡ç¨‹ä¸­çš„å…³é”®çŠ¶æ€ä¿¡æ¯ã€‚

### æ•°æ®ç»“æ„è®¾è®¡

```python
@dataclass
class Checkpoint:
    last_scan_time: Optional[str] = None
    scanned_shas: Set[str] = field(default_factory=set)
    processed_queries: Set[str] = field(default_factory=set)
```

å„å­—æ®µå«ä¹‰å¦‚ä¸‹ï¼š

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `last_scan_time` | `str` | ä¸Šæ¬¡æ‰«æå®Œæˆçš„æ—¶é—´æˆ³ï¼ˆISOæ ¼å¼ï¼‰ |
| `scanned_shas` | `Set[str]` | å·²æ‰«æè¿‡çš„æ–‡ä»¶SHAå€¼é›†åˆï¼Œé˜²æ­¢é‡å¤å¤„ç† |
| `processed_queries` | `Set[str]` | å·²å¤„ç†çš„æœç´¢æŸ¥è¯¢è¯­å¥é›†åˆ |

### åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æœºåˆ¶

ç”±äº `Set` ç±»å‹æ— æ³•ç›´æ¥è¢« JSON åºåˆ—åŒ–ï¼Œ`Checkpoint` æä¾›äº† `to_dict()` å’Œ `from_dict()` æ–¹æ³•è¿›è¡Œè½¬æ¢ã€‚

#### åºåˆ—åŒ–ï¼š`to_dict()`

```python
def to_dict(self) -> Dict[str, Any]:
    """è½¬æ¢ä¸ºå­—å…¸æ ¼å¼ï¼Œä½†ä¸åŒ…å«scanned_shasï¼ˆå•ç‹¬å­˜å‚¨ï¼‰"""
    return {
        "last_scan_time": self.last_scan_time,
        "processed_queries": list(self.processed_queries)
    }
```

æ³¨æ„ï¼š`scanned_shas` **ä¸åŒ…å«åœ¨ `to_dict()` è¾“å‡ºä¸­**ï¼Œè€Œæ˜¯å•ç‹¬ä¿å­˜åœ¨ `scanned_shas.txt` æ–‡ä»¶ä¸­ï¼Œä»¥æé«˜è¯»å†™æ•ˆç‡å’Œå¯è¯»æ€§ã€‚

#### ååºåˆ—åŒ–ï¼š`from_dict(cls, data)`

```python
@classmethod
def from_dict(cls, data: Dict[str, Any]) -> 'Checkpoint':
    """ä»å­—å…¸åˆ›å»ºCheckpointå¯¹è±¡ï¼Œscanned_shaséœ€è¦å•ç‹¬åŠ è½½"""
    return cls(
        last_scan_time=data.get("last_scan_time"),
        scanned_shas=set(),  # å°†é€šè¿‡FileManagerå•ç‹¬åŠ è½½
        processed_queries=set(data.get("processed_queries", []))
    )
```

`scanned_shas` åœ¨åˆå§‹åŒ–æ—¶ä¸ºç©ºé›†ï¼Œåç»­ç”± `FileManager.load_scanned_shas()` æ–¹æ³•å•ç‹¬åŠ è½½ã€‚

```mermaid
classDiagram
class Checkpoint {
+str last_scan_time
+Set[str] scanned_shas
+Set[str] processed_queries
+to_dict() Dict[str,Any]
+from_dict(data) Checkpoint
+add_scanned_sha(sha)
+add_processed_query(query)
+update_scan_time()
}
```

**å›¾ç¤ºæ¥æº**  
- [models/__init__.py](file://src\models\__init__.py#L10-L44)

**æœ¬èŠ‚æ¥æº**  
- [models/__init__.py](file://src\models\__init__.py#L10-L44)

## æ–‡ä»¶ç®¡ç†å™¨ï¼ˆFileManagerï¼‰æ ¸å¿ƒé€»è¾‘

`FileManager` ç±»çš„åŠŸèƒ½å·²ç”± `file_service` æ¨¡å—ç»§æ‰¿å¹¶å¢å¼ºï¼Œå…¶æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼š

- åˆå§‹åŒ–æ•°æ®ç›®å½•å’Œæ—¥å¿—æ–‡ä»¶
- åŠ è½½å’Œä¿å­˜æ£€æŸ¥ç‚¹
- ç®¡ç†åŠ¨æ€æ–‡ä»¶åï¼ˆæŒ‰æ—¥æœŸåˆ†å‰²ï¼‰
- å®‰å…¨åœ°è¯»å†™å„ç±»ç»“æœæ–‡ä»¶

### åˆå§‹åŒ–æµç¨‹

```python
def __init__(self, data_dir: str):
    """
    åˆå§‹åŒ–FileManagerå¹¶å®Œæˆæ‰€æœ‰å¿…è¦çš„è®¾ç½®
    
    Args:
        data_dir: æ•°æ®ç›®å½•è·¯å¾„
    """
    logger.info("ğŸ”§ Initializing FileManager")

    # 1. åŸºç¡€è·¯å¾„è®¾ç½®
    self.data_dir = data_dir
    self.checkpoint_file = os.path.join(data_dir, "checkpoint.json")
    self.scanned_shas_file = os.path.join(data_dir, Config.SCANNED_SHAS_FILE)

    # 2. åŠ¨æ€æ–‡ä»¶å
    self._detail_log_filename: Optional[str] = None
    self._keys_valid_filename: Optional[str] = None
    self._rate_limited_filename: Optional[str] = None
    self._rate_limited_detail_filename: Optional[str] = None

    # 3. åˆ›å»ºæ•°æ®ç›®å½•
    if not os.path.exists(self.data_dir):
        os.makedirs(self.data_dir, exist_ok=True)
        logger.info(f"Created data directory: {self.data_dir}")
    else:
        logger.info(f"Data directory exists: {self.data_dir}")

    # 4. åŠ è½½æœç´¢æŸ¥è¯¢
    try:
        self._search_queries = self.load_search_queries(Config.QUERIES_FILE)
        logger.info(f"âœ… Loaded {len(self._search_queries)} search queries")
    except Exception as e:
        logger.error(f"âŒ Failed to load search queries: {e}")
        self._search_queries = []

    # 5. åˆå§‹åŒ–æ–‡ä»¶å
    start_time = datetime.now()

    self._keys_valid_filename = os.path.join(
        self.data_dir,
        f"{Config.VALID_KEY_PREFIX}{start_time.strftime('%Y%m%d')}.txt"
    )

    self._rate_limited_filename = os.path.join(
        self.data_dir,
        f"{Config.RATE_LIMITED_KEY_PREFIX}{start_time.strftime('%Y%m%d')}.txt"
    )

    self._detail_log_filename = os.path.join(
        self.data_dir,
        f"{ Config.VALID_KEY_DETAIL_PREFIX.rstrip('_')}{start_time.strftime('%Y%m%d')}.log"
    )
    self._rate_limited_detail_filename = os.path.join(
        self.data_dir,
        f"{Config.RATE_LIMITED_KEY_DETAIL_PREFIX}{start_time.strftime('%Y%m%d')}.log"
    )

    # åˆ›å»ºæ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ï¼Œå…ˆç¡®ä¿çˆ¶ç›®å½•å­˜åœ¨
    for filename in [self._detail_log_filename, self._keys_valid_filename, self._rate_limited_filename, self._rate_limited_detail_filename]:
        if not os.path.exists(filename):
            # ç¡®ä¿çˆ¶ç›®å½•å­˜åœ¨ï¼ˆç±»ä¼¼ mkdir -pï¼‰
            parent_dir = os.path.dirname(filename)
            if parent_dir:
                os.makedirs(parent_dir, exist_ok=True)

            with open(filename, 'a', encoding='utf-8') as f:
                f.write("")

    logger.info(f"Initialized keys valid filename: {self._keys_valid_filename}")
    logger.info(f"Initialized rate limited filename: {self._rate_limited_filename}")
    logger.info(f"Initialized detail log filename: {self._detail_log_filename}")
    logger.info(f"Initialized rate limited detail filename: {self._rate_limited_detail_filename}")

    logger.info("âœ… FileManager initialization complete")
```

åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨åˆ›å»ºå¿…è¦çš„ç›®å½•å’Œæ–‡ä»¶ï¼Œå¹¶æ ¹æ®å½“å‰æ—¶é—´ç”Ÿæˆå¸¦æ—¥æœŸåç¼€çš„æ—¥å¿—æ–‡ä»¶åï¼Œä¾‹å¦‚ï¼š

- `keys/keys_valid_20250405.txt`
- `logs/keys_valid_detail_20250405.log`

### æ£€æŸ¥ç‚¹åŠ è½½ä¸ä¿å­˜

#### åŠ è½½æµç¨‹

```python
def load_checkpoint(self) -> Checkpoint:
    """åŠ è½½checkpointæ•°æ®"""
    checkpoint = Checkpoint()

    if os.path.exists(self.checkpoint_file):
        try:
            with open(self.checkpoint_file, "r", encoding="utf-8") as f:
                data = json.load(f)
                checkpoint = Checkpoint.from_dict(data)
        except Exception as e:
            logger.warning(f"Cannot read {self.checkpoint_file}: {e}. Will create new checkpoint.")
    else:
        logger.warning(f"{self.checkpoint_file} not found. Will create new checkpoint.")
        self.save_checkpoint(checkpoint)

    # ä»å•ç‹¬æ–‡ä»¶åŠ è½½scanned_shas
    checkpoint.scanned_shas = self.load_scanned_shas()

    return checkpoint
```

#### ä¿å­˜æµç¨‹

```python
def save_checkpoint(self, checkpoint: Checkpoint) -> None:
    """ä¿å­˜checkpointæ•°æ®"""
    # 1. ä¿å­˜scanned_shasåˆ°å•ç‹¬æ–‡ä»¶
    self.save_scanned_shas(checkpoint.scanned_shas)
    # 2. ä¿å­˜å…¶ä»–æ•°æ®åˆ°checkpoint.json
    try:
        with open(self.checkpoint_file, "w", encoding="utf-8") as f:
            json.dump(checkpoint.to_dict(), f, ensure_ascii=False, indent=2)
        checkpoint = self.load_checkpoint()
    except Exception as e:
        logger.error(f"Failed to save {self.checkpoint_file}: {e}")
```

è¿™ç§**åˆ†ç¦»å­˜å‚¨**çš„è®¾è®¡æé«˜äº†æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ï¼Œé¿å…å¤§æ–‡ä»¶é¢‘ç¹è¯»å†™ã€‚

```mermaid
sequenceDiagram
participant FM as FileManager
participant CP as Checkpoint
participant FS as æ–‡ä»¶ç³»ç»Ÿ
FM->>FS : æ£€æŸ¥ checkpoint.json æ˜¯å¦å­˜åœ¨
alt æ–‡ä»¶å­˜åœ¨
FS-->>FM : è¿”å›æ–‡ä»¶å†…å®¹
FM->>CP : è°ƒç”¨ from_dict()
CP-->>FM : è¿”å› Checkpoint å®ä¾‹
else æ–‡ä»¶ä¸å­˜åœ¨
FM->>FS : åˆ›å»ºæ–° checkpoint.json
FM->>CP : åˆ›å»ºç©º Checkpoint
end
FM->>FS : è¯»å– scanned_shas.txt
FS-->>FM : è¿”å›SHAåˆ—è¡¨
FM->>CP : è®¾ç½® scanned_shas é›†åˆ
CP-->>FM : å®Œæ•´çš„ Checkpoint å¯¹è±¡
```

**å›¾ç¤ºæ¥æº**  
- [file_service.py](file://src\services\file_service.py#L173-L237)

**æœ¬èŠ‚æ¥æº**  
- [file_service.py](file://src\services\file_service.py#L50-L237)

## å¢é‡æ‰«æä¸çŠ¶æ€æ›´æ–°ç­–ç•¥

ç³»ç»Ÿé€šè¿‡ `Checkpoint` å®ç°**å¢é‡æ‰«æ**ï¼Œé¿å…é‡å¤å¤„ç†å·²æ‰«æçš„æ–‡ä»¶ã€‚

### æ—¶é—´æˆ³ç®¡ç†

æ¯æ¬¡æ‰«æå¾ªç¯ç»“æŸæ—¶ï¼Œè°ƒç”¨ `checkpoint.update_scan_time()` æ›´æ–°æ—¶é—´æˆ³ï¼š

```python
def update_scan_time(self) -> None:
    self.last_scan_time = datetime.utcnow().isoformat()
```

åœ¨ `scanner.py` ä¸­ï¼Œ`should_skip_item()` å‡½æ•°åˆ©ç”¨æ­¤æ—¶é—´æˆ³åˆ¤æ–­ä»“åº“æ˜¯å¦éœ€è¦è·³è¿‡ï¼š

```python
if repo_pushed_dt <= last_scan_dt:
    return True, "time_filter"
```

### å·²å¤„ç†ä»“åº“è®°å½•

- `scanned_shas`ï¼šè®°å½•æ¯ä¸ªæ–‡ä»¶çš„å”¯ä¸€SHAå€¼ï¼Œé˜²æ­¢é‡å¤æ‰«æåŒä¸€æ–‡ä»¶ã€‚
- `processed_queries`ï¼šè®°å½•å·²æ‰§è¡Œçš„æœç´¢æŸ¥è¯¢ï¼Œé¿å…é‡å¤æ‰§è¡Œç›¸åŒæŸ¥è¯¢ã€‚

æ¯æ¬¡å¤„ç†å®Œä¸€ä¸ªæ–‡ä»¶åï¼Œç«‹å³è°ƒç”¨ï¼š

```python
checkpoint.add_scanned_sha(item.get("sha"))
```

å¹¶åœ¨æ¯ä¸ªæŸ¥è¯¢æ‰§è¡Œå®Œæ¯•åï¼š

```python
checkpoint.add_processed_query(normalized_q)
```

è¿™äº›çŠ¶æ€æœ€ç»ˆé€šè¿‡ `file_service.save_checkpoint(checkpoint)` æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚

**æœ¬èŠ‚æ¥æº**  
- [models/__init__.py](file://src\models\__init__.py#L47)
- [scanner.py](file://src\core\scanner.py#L220-L250)

## æ–‡ä»¶è¯»å†™å®‰å…¨ä¸å¼‚å¸¸å¤„ç†

ä¸ºç¡®ä¿æ•°æ®å®Œæ•´æ€§ï¼Œ`file_service` å®ç°äº†å¤šå±‚å®‰å…¨ä¿éšœã€‚

### å¼‚å¸¸å¤„ç†æœºåˆ¶

æ‰€æœ‰æ–‡ä»¶æ“ä½œå‡åŒ…è£¹åœ¨ `try-except` å—ä¸­ï¼š

```python
try:
    with open(filename, "w") as f:
        json.dump(data, f, ensure_ascii=False, indent=2)
except Exception as e:
    logger.error(f"Failed to save {filename}: {e}")
```

å³ä½¿å†™å…¥å¤±è´¥ï¼Œç¨‹åºä¹Ÿä¸ä¼šå´©æºƒï¼Œè€Œæ˜¯è®°å½•é”™è¯¯å¹¶ç»§ç»­è¿è¡Œã€‚

### æ•°æ®å®Œæ•´æ€§æ ¡éªŒ

- **å†™å…¥å‰åˆ›å»ºç›®å½•**ï¼šä½¿ç”¨ `os.makedirs(parent_dir, exist_ok=True)` ç¡®ä¿çˆ¶ç›®å½•å­˜åœ¨ã€‚
- **è¿½åŠ æ¨¡å¼å†™å…¥**ï¼šå¯¹äºæ—¥å¿—æ–‡ä»¶ä½¿ç”¨ `'a'` æ¨¡å¼ï¼Œé˜²æ­¢è¦†ç›–å·²æœ‰å†…å®¹ã€‚
- **UTF-8ç¼–ç **ï¼šç»Ÿä¸€ä½¿ç”¨ `encoding='utf-8'` é¿å…ç¼–ç é—®é¢˜ã€‚

### å¹¶å‘è®¿é—®æ§åˆ¶

è™½ç„¶å½“å‰æœªæ˜¾å¼ä½¿ç”¨é”æœºåˆ¶ï¼Œä½†é€šè¿‡ä»¥ä¸‹æ–¹å¼é™ä½å¹¶å‘é£é™©ï¼š

- **å°ç²’åº¦å†™å…¥**ï¼šé¢‘ç¹è°ƒç”¨ `save_checkpoint()`ï¼Œå‡å°‘å•æ¬¡å†™å…¥é‡ã€‚
- **åŸå­æ€§æ“ä½œ**ï¼šJSONå†™å…¥æ˜¯åŸå­çš„ï¼ˆè¦†ç›–å†™ï¼‰ï¼Œé¿å…éƒ¨åˆ†å†™å…¥é—®é¢˜ã€‚
- **æ—¥å¿—è¿½åŠ **ï¼šæ—¥å¿—æ–‡ä»¶é‡‡ç”¨è¿½åŠ æ–¹å¼ï¼Œå¤©ç„¶æ”¯æŒå¹¶å‘å†™å…¥ã€‚

æ­¤å¤–ï¼Œ`update_dynamic_filenames()` æ–¹æ³•ä¼šæ ¹æ®æ—¥æœŸè‡ªåŠ¨åˆ‡æ¢æ–‡ä»¶åï¼Œè¿›ä¸€æ­¥å‡å°‘å•ä¸ªæ–‡ä»¶çš„å†™å…¥å‹åŠ›ã€‚

**æœ¬èŠ‚æ¥æº**  
- [file_service.py](file://src\services\file_service.py#L238-L431)

## å®é™…åº”ç”¨åœºæ™¯åˆ†æ

å‡è®¾ç³»ç»Ÿæ¯å¤©è¿è¡Œä¸€æ¬¡ï¼Œå…¶å…¸å‹å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š

1. **å¯åŠ¨é˜¶æ®µ**ï¼š
   - åŠ è½½ `checkpoint.json` å’Œ `scanned_shas.txt`
   - è·å–ä¸Šæ¬¡æ‰«ææ—¶é—´ `last_scan_time`
   - åˆå§‹åŒ–å½“æ—¥æ—¥å¿—æ–‡ä»¶å

2. **æ‰«æé˜¶æ®µ**ï¼š
   - éå†æ‰€æœ‰æœç´¢æŸ¥è¯¢
   - å¯¹æ¯ä¸ªæœç´¢ç»“æœï¼Œæ£€æŸ¥æ˜¯å¦æ»¡è¶³è·³è¿‡æ¡ä»¶ï¼ˆæ—¶é—´ã€SHAã€è·¯å¾„ç­‰ï¼‰
   - æå–å¹¶éªŒè¯APIå¯†é’¥
   - å°†æœ‰æ•ˆå¯†é’¥å†™å…¥ `keys_valid_*.txt` å’Œæ—¥å¿—æ–‡ä»¶

3. **çŠ¶æ€æ›´æ–°**ï¼š
   - æ¯å¤„ç†20ä¸ªæ–‡ä»¶ï¼Œä¿å­˜ä¸€æ¬¡æ£€æŸ¥ç‚¹
   - æ¯å®Œæˆä¸€ä¸ªæŸ¥è¯¢ï¼Œæ›´æ–° `processed_queries` å’Œ `last_scan_time`

4. **ç»“æŸé˜¶æ®µ**ï¼š
   - ä¿å­˜æœ€ç»ˆæ£€æŸ¥ç‚¹
   - ç¨‹åºé€€å‡º

è¿™ç§æ–¹å¼ç¡®ä¿äº†å³ä½¿åœ¨æ‰«æä¸­é€”æ–­ç”µæˆ–å´©æºƒï¼Œé‡å¯åä¹Ÿèƒ½ä»æœ€è¿‘çš„æ£€æŸ¥ç‚¹æ¢å¤ï¼Œä¸ä¼šä¸¢å¤±å·²å¤„ç†çš„æ•°æ®ã€‚

**æœ¬èŠ‚æ¥æº**  
- [scanner.py](file://src\core\scanner.py#L300-L500)
- [file_service.py](file://src\services\file_service.py#L238-L431)

## æ€»ç»“

`file_service.py` æ¨¡å—é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„ `Checkpoint` ç±»å’Œ `file_service` ç±»ï¼Œå®ç°äº†é«˜æ•ˆã€å¯é çš„çŠ¶æ€ç®¡ç†æœºåˆ¶ã€‚å…¶æ ¸å¿ƒä¼˜åŠ¿åŒ…æ‹¬ï¼š

- **æ–­ç‚¹ç»­ä¼ **ï¼šåˆ©ç”¨ `checkpoint.json` å’Œ `scanned_shas.txt` å®ç°æ‰«æè¿›åº¦æŒä¹…åŒ–ã€‚
- **å¢é‡æ‰«æ**ï¼šåŸºäºæ—¶é—´æˆ³å’ŒSHAå€¼é¿å…é‡å¤å·¥ä½œã€‚
- **åŠ¨æ€æ—¥å¿—**ï¼šæŒ‰æ—¥æœŸåˆ†å‰²æ—¥å¿—æ–‡ä»¶ï¼Œä¾¿äºå½’æ¡£å’Œåˆ†æã€‚
- **å®‰å…¨å†™å…¥**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œæ•°æ®å®Œæ•´æ€§ä¿éšœã€‚

è¯¥è®¾è®¡ä¸ä»…æå‡äº†ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä¹Ÿä¸ºåç»­æ‰©å±•ï¼ˆå¦‚æ”¯æŒå¤šèŠ‚ç‚¹ååŒæ‰«æï¼‰å¥ å®šäº†åŸºç¡€ã€‚

**æœ¬èŠ‚æ¥æº**  
- [file_service.py](file://src\services\file_service.py#L1-L431)
- [scanner.py](file://src\core\scanner.py#L1-L512)