# å¯†é’¥æå–æœºåˆ¶

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**  
- [app/hajimi_king.py](file://app/hajimi_king.py) - *æ–°å¢ OpenRouter å¯†é’¥æå–åŠŸèƒ½*
- [common/config.py](file://common/config.py) - *æ–°å¢ OpenRouter ç›¸å…³é…ç½®é¡¹*
- [utils/file_manager.py](file://utils/file_manager.py)
- [utils/github_client.py](file://utils/github_client.py)
- [OPENROUTER_USAGE.md](file://OPENROUTER_USAGE.md) - *æ–°å¢ OpenRouter ä½¿ç”¨è¯´æ˜æ–‡æ¡£*
</cite>

## æ›´æ–°æ‘˜è¦
**å˜æ›´å†…å®¹**  
- æ–°å¢ OpenRouter å¹³å°å¯†é’¥æå–åŠŸèƒ½ï¼Œæ”¯æŒ `sk-or-v1-` æ ¼å¼å¯†é’¥è¯†åˆ«
- æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼è®¾è®¡ä¸åº”ç”¨ç« èŠ‚ï¼Œå¢åŠ  OpenRouter æ­£åˆ™æ¨¡å¼è¯´æ˜
- æ›´æ–°ä¸Šä¸‹æ–‡éªŒè¯æœºåˆ¶ï¼Œå¢åŠ  OpenRouter ä¸Šä¸‹æ–‡å…³é”®è¯åŒ¹é…
- å¢åŠ é…ç½®ç®¡ç†ä¸å¯æ‰©å±•æ€§ä¸­çš„ OpenRouter é…ç½®é¡¹
- æ–°å¢ OpenRouter ä¸“ç”¨æ‰«ææ¨¡å¼è¯´æ˜

## ç›®å½•
1. [é¡¹ç›®ç»“æ„åˆ†æ](#é¡¹ç›®ç»“æ„åˆ†æ)  
2. [æ ¸å¿ƒåŠŸèƒ½æ¦‚è¿°](#æ ¸å¿ƒåŠŸèƒ½æ¦‚è¿°)  
3. [å¯†é’¥æå–é€»è¾‘è¯¦è§£](#å¯†é’¥æå–é€»è¾‘è¯¦è§£)  
4. [æ­£åˆ™è¡¨è¾¾å¼è®¾è®¡ä¸åº”ç”¨](#æ­£åˆ™è¡¨è¾¾å¼è®¾è®¡ä¸åº”ç”¨)  
5. [ä¸Šä¸‹æ–‡éªŒè¯æœºåˆ¶](#ä¸Šä¸‹æ–‡éªŒè¯æœºåˆ¶)  
6. [æ–‡ä»¶ç®¡ç†ä¸æŒä¹…åŒ–](#æ–‡ä»¶ç®¡ç†ä¸æŒä¹…åŒ–)  
7. [æ•°æ®æµä¸å¤„ç†æµç¨‹](#æ•°æ®æµä¸å¤„ç†æµç¨‹)  
8. [é…ç½®ç®¡ç†ä¸å¯æ‰©å±•æ€§](#é…ç½®ç®¡ç†ä¸å¯æ‰©å±•æ€§)  
9. [é”™è¯¯å¤„ç†ä¸æ—¥å¿—è®°å½•](#é”™è¯¯å¤„ç†ä¸æ—¥å¿—è®°å½•)  
10. [æ€»ç»“ä¸å»ºè®®](#æ€»ç»“ä¸å»ºè®®)

## é¡¹ç›®ç»“æ„åˆ†æ

æœ¬é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªç›®å½•ï¼š

- `app/`ï¼šä¸»åº”ç”¨å…¥å£ï¼ŒåŒ…å«æ ¸å¿ƒé€»è¾‘ `hajimi_king.py`
- `common/`ï¼šé€šç”¨ç»„ä»¶ï¼Œå¦‚æ—¥å¿—å’Œé…ç½®ç®¡ç†
- `scripts/`ï¼šè„šæœ¬å·¥å…·ï¼Œå¦‚å¹²è¿è¡Œæµ‹è¯•
- `utils/`ï¼šå·¥å…·ç±»æ¨¡å—ï¼ŒåŒ…æ‹¬æ–‡ä»¶ç®¡ç†ã€GitHubå®¢æˆ·ç«¯ã€åŒæ­¥å·¥å…·ç­‰

æ ¸å¿ƒæ–‡ä»¶åŒ…æ‹¬ï¼š
- `app/hajimi_king.py`ï¼šä¸»ç¨‹åºï¼Œè´Ÿè´£å¯†é’¥æœç´¢ã€æå–ã€éªŒè¯å’Œä¿å­˜
- `common/config.py`ï¼šé…ç½®ç®¡ç†ï¼ŒåŠ è½½ç¯å¢ƒå˜é‡å¹¶æä¾›å…¨å±€é…ç½®
- `utils/file_manager.py`ï¼šæ–‡ä»¶æ“ä½œç®¡ç†å™¨ï¼Œè´Ÿè´£è¯»å†™æŸ¥è¯¢ã€æ£€æŸ¥ç‚¹ã€å¯†é’¥æ–‡ä»¶ç­‰
- `utils/github_client.py`ï¼šGitHub API å®¢æˆ·ç«¯ï¼Œç”¨äºæœç´¢å’Œè·å–æ–‡ä»¶å†…å®¹

```mermaid
graph TD
A["ä¸»ç¨‹åº<br/>hajimi_king.py"] --> B["é…ç½®ç®¡ç†<br/>config.py"]
A --> C["æ–‡ä»¶ç®¡ç†å™¨<br/>file_manager.py"]
A --> D["GitHubå®¢æˆ·ç«¯<br/>github_client.py"]
B --> E["ç¯å¢ƒå˜é‡<br/>.env"]
C --> F["æ•°æ®ç›®å½•<br/>DATA_PATH"]
D --> G["GitHub API"]
A --> H["æ—¥å¿—ç³»ç»Ÿ<br/>Logger.py"]
```

**å›¾ç¤ºæ¥æº**  
- [app/hajimi_king.py](file://app/hajimi_king.py#L1-L523)
- [common/config.py](file://common/config.py#L1-L203)
- [utils/file_manager.py](file://utils/file_manager.py#L1-L492)
- [utils/github_client.py](file://utils/github_client.py)

## æ ¸å¿ƒåŠŸèƒ½æ¦‚è¿°

`APIKEY-king` æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–å¯†é’¥æå–å·¥å…·ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

- ä» GitHub å…¬å¼€ä»£ç ä¸­æœç´¢æ½œåœ¨çš„ API å¯†é’¥
- æ”¯æŒå¤šç§å¹³å°å¯†é’¥æ¨¡å¼è¯†åˆ«ï¼ˆGeminiã€ModelScopeã€OpenRouterï¼‰
- å¯¹æå–çš„å¯†é’¥è¿›è¡Œæœ‰æ•ˆæ€§éªŒè¯
- å°†æœ‰æ•ˆå¯†é’¥æŒä¹…åŒ–å­˜å‚¨å¹¶æ”¯æŒå¤–éƒ¨åŒæ­¥
- æ”¯æŒå¢é‡æ‰«æä¸æ–­ç‚¹ç»­ä¼ 

å…¶æ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š
1. åŠ è½½é…ç½®ä¸æœç´¢æŸ¥è¯¢
2. é€šè¿‡ GitHub API æœç´¢åŒ¹é…æ–‡ä»¶
3. ä¸‹è½½æ–‡ä»¶å†…å®¹å¹¶æå–å€™é€‰å¯†é’¥
4. éªŒè¯å¯†é’¥æœ‰æ•ˆæ€§
5. ä¿å­˜ç»“æœå¹¶æ›´æ–°æ£€æŸ¥ç‚¹

**æœ¬èŠ‚æ¥æº**  
- [app/hajimi_king.py](file://app/hajimi_king.py#L1-L523)
- [common/config.py](file://common/config.py#L1-L203)

## å¯†é’¥æå–é€»è¾‘è¯¦è§£

### Gemini å¯†é’¥æå–

Gemini å¹³å°çš„å¯†é’¥é‡‡ç”¨å›ºå®šå‰ç¼€ `AIzaSy`ï¼Œåæ¥ 33 ä½ Base64 ç¼–ç å­—ç¬¦ï¼ˆå« `-` å’Œ `_`ï¼‰ã€‚

```python
def extract_keys_from_content(content: str) -> List[str]:
    pattern = r'(AIzaSy[A-Za-z0-9\-_]{33})'
    return re.findall(pattern, content)
```

è¯¥å‡½æ•°é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ä»æ–‡æœ¬ä¸­æå–æ‰€æœ‰ç¬¦åˆæ¨¡å¼çš„å¯†é’¥ã€‚

### ModelScope å¯†é’¥æå–

ModelScope å¯†é’¥æ ¼å¼ä¸º `ms-` åæ¥ UUID æ ¼å¼å­—ç¬¦ä¸²ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰æˆ–æ›´é•¿çš„è¿å­—ç¬¦åˆ†éš”å­—ç¬¦ä¸²ï¼ˆå®½æ¾æ¨¡å¼ï¼‰ã€‚

```python
def extract_ms_keys_for_modelscope(content: str) -> List[str]:
    base_urls = Config.TARGET_BASE_URLS
    has_base, base_positions = _contains_base_url(content, base_urls)
    if not has_base:
        return []
    # ... å…¶ä»–é€»è¾‘
```

æå–é€»è¾‘å—ä»¥ä¸‹é…ç½®æ§åˆ¶ï¼š
- `TARGET_BASE_URLS`ï¼šå¿…é¡»å‡ºç°åœ¨æ–‡ä»¶ä¸­çš„ API åœ°å€
- `MS_USE_LOOSE_PATTERN`ï¼šæ˜¯å¦å¯ç”¨å®½æ¾æ¨¡å¼
- `MS_PROXIMITY_CHARS`ï¼šå¯†é’¥ä¸ base_url çš„æœ€å¤§å­—ç¬¦è·ç¦»
- `MS_REQUIRE_KEY_CONTEXT`ï¼šæ˜¯å¦è¦æ±‚ä¸Šä¸‹æ–‡å…³é”®è¯ï¼ˆå¦‚ keyã€tokenï¼‰

### OpenRouter å¯†é’¥æå–

OpenRouter å¯†é’¥æ ¼å¼ä¸º `sk-or-v1-` åæ¥ 64 ä½åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰æˆ–è‡³å°‘ 40 ä½åå…­è¿›åˆ¶å­—ç¬¦ï¼ˆå®½æ¾æ¨¡å¼ï¼‰ã€‚

```python
def extract_openrouter_keys(content: str) -> List[str]:
    """
    å½“åŒä¸€æ–‡ä»¶ä¸­åŒ…å« Config.OPENROUTER_BASE_URLS ä»»ä¸€å€¼æ—¶ï¼Œæå– OpenRouter API keysã€‚
    OpenRouter key æ ¼å¼: sk-or-v1-[64ä½åå…­è¿›åˆ¶å­—ç¬¦ä¸²]
    å—æ§äºä»¥ä¸‹é…ç½®ï¼š
      - OPENROUTER_BASE_URLS
      - OPENROUTER_USE_LOOSE_PATTERN (bool)
      - OPENROUTER_PROXIMITY_CHARS (int, å½“ä½¿ç”¨å®½æ¾æ¨¡å¼æ—¶å»ºè®®>0)
      - OPENROUTER_REQUIRE_KEY_CONTEXT (bool)
    """
    base_urls = Config.OPENROUTER_BASE_URLS
    has_base, base_positions = _contains_base_url(content, base_urls)
    if not has_base:
        return []

    # OpenRouter key æ­£åˆ™æ¨¡å¼
    # ä¸¥æ ¼æ¨¡å¼ï¼šsk-or-v1-[64ä½åå…­è¿›åˆ¶]
    strict_pat = r'\bsk-or-v1-[0-9a-f]{64}\b'
    # å®½æ¾æ¨¡å¼ï¼šsk-or-v1-[è‡³å°‘40ä½å­—ç¬¦]
    loose_pat = r'\bsk-or-v1-[0-9a-f]{40,}\b'
    
    use_loose = Config.parse_bool(Config.OPENROUTER_USE_LOOSE_PATTERN)
    pattern = loose_pat if use_loose else strict_pat

    proximity_chars = Config.OPENROUTER_PROXIMITY_CHARS if use_loose else 0
    require_ctx = Config.parse_bool(Config.OPENROUTER_REQUIRE_KEY_CONTEXT)
    ctx_re = re.compile(r"(key|token|secret|authorization|api[-_ ]?key|openrouter)", re.IGNORECASE)

    results: List[str] = []
    for m in re.finditer(pattern, content, re.IGNORECASE):
        k = m.group(0)
        
        # è¿‡æ»¤æ˜æ˜¾çš„å ä½ç¬¦
        if "0000000000000000" in k.lower() or "your_key" in k.lower() or "example" in k.lower():
            continue

        # é‚»è¿‘æ€§æ£€æŸ¥ï¼ˆå½“ä½¿ç”¨å®½æ¾æ¨¡å¼æ—¶ï¼‰
        if proximity_chars and base_positions:
            pos = m.start()
            near = any(abs(pos - bp) <= proximity_chars for bp in base_positions)
            if not near:
                continue

        # ä¸Šä¸‹æ–‡æ£€æŸ¥ï¼ˆå½“å¯ç”¨æ—¶ï¼‰
        if require_ctx:
            start = max(0, m.start() - 80)
            end = min(len(content), m.end() + 80)
            snippet = content[start:end]
            if not ctx_re.search(snippet):
                continue

        results.append(k)

    # å»é‡ä¸”ä¿åº
    seen = set()
    deduped = [x for x in results if not (x in seen or seen.add(x))]
    return deduped
```

**æœ¬èŠ‚æ¥æº**  
- [app/hajimi_king.py](file://app/hajimi_king.py#L162-L218)

## æ­£åˆ™è¡¨è¾¾å¼è®¾è®¡ä¸åº”ç”¨

### Gemini å¯†é’¥æ­£åˆ™

```regex
AIzaSy[A-Za-z0-9\-_]{33}
```

- å‰ç¼€ï¼š`AIzaSy`
- å­—ç¬¦é›†ï¼šå¤§å°å†™å­—æ¯ã€æ•°å­—ã€è¿å­—ç¬¦ã€ä¸‹åˆ’çº¿
- é•¿åº¦ï¼š33 ä½
- ç¤ºä¾‹ï¼š`AIzaSyBx1y2z3A4b5c6D7e8F9g0H1i2J3k4L5m6N7o8P`

### ModelScope å¯†é’¥æ­£åˆ™

#### ä¸¥æ ¼æ¨¡å¼
```regex
(?i)\bms-[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\b
```

- å‰ç¼€ï¼š`ms-`
- æ ¼å¼ï¼šæ ‡å‡† UUID v4
- ä¸åŒºåˆ†å¤§å°å†™

#### å®½æ¾æ¨¡å¼
```regex
(?i)\bms-[0-9a-f-]{30,}\b
```

- å‰ç¼€ï¼š`ms-`
- å­—ç¬¦é›†ï¼šåå…­è¿›åˆ¶å­—ç¬¦å’Œè¿å­—ç¬¦
- æœ€å°é•¿åº¦ï¼š30 ä½
- ç”¨äºåŒ¹é…éæ ‡å‡†æ ¼å¼çš„å¯†é’¥

### OpenRouter å¯†é’¥æ­£åˆ™

#### ä¸¥æ ¼æ¨¡å¼
```regex
\bsk-or-v1-[0-9a-f]{64}\b
```

- å‰ç¼€ï¼š`sk-or-v1-`
- å­—ç¬¦é›†ï¼šåå…­è¿›åˆ¶å­—ç¬¦ï¼ˆ0-9, a-fï¼‰
- é•¿åº¦ï¼š64 ä½
- ä¸åŒºåˆ†å¤§å°å†™
- ç¤ºä¾‹ï¼š`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`

#### å®½æ¾æ¨¡å¼
```regex
\bsk-or-v1-[0-9a-f]{40,}\b
```

- å‰ç¼€ï¼š`sk-or-v1-`
- å­—ç¬¦é›†ï¼šåå…­è¿›åˆ¶å­—ç¬¦
- æœ€å°é•¿åº¦ï¼š40 ä½
- ç”¨äºåŒ¹é…é•¿åº¦ä¸è¶³64ä½ä½†å¯èƒ½æœ‰æ•ˆçš„å¯†é’¥

```mermaid
flowchart TD
Start([å¼€å§‹æå–]) --> CheckBaseURL["æ£€æŸ¥æ˜¯å¦åŒ…å«<br/>TARGET_BASE_URL"]
CheckBaseURL --> |å¦| ReturnEmpty["è¿”å›ç©ºåˆ—è¡¨"]
CheckBaseURL --> |æ˜¯| MatchPattern["åŒ¹é…å¯†é’¥æ¨¡å¼"]
MatchPattern --> UseLoose["æ˜¯å¦å¯ç”¨å®½æ¾æ¨¡å¼?"]
UseLoose --> |æ˜¯| LoosePattern["ä½¿ç”¨å®½æ¾æ­£åˆ™"]
UseLoose --> |å¦| StrictPattern["ä½¿ç”¨ä¸¥æ ¼æ­£åˆ™"]
LoosePattern --> ApplyProximity["åº”ç”¨ proximity è¿‡æ»¤"]
StrictPattern --> ApplyContext["åº”ç”¨ä¸Šä¸‹æ–‡è¿‡æ»¤"]
ApplyProximity --> ApplyContext
ApplyContext --> FilterPlaceholder["è¿‡æ»¤å ä½ç¬¦"]
FilterPlaceholder --> Deduplicate["å»é‡å¹¶è¿”å›"]
```

**å›¾ç¤ºæ¥æº**  
- [app/hajimi_king.py](file://app/hajimi_king.py#L104-L149)

## ä¸Šä¸‹æ–‡éªŒè¯æœºåˆ¶

ä¸ºé™ä½è¯¯æŠ¥ç‡ï¼Œç³»ç»Ÿé‡‡ç”¨å¤šå±‚ä¸Šä¸‹æ–‡éªŒè¯ï¼š

### 1. åŸºç¡€ URL å…±ç°éªŒè¯

åªæœ‰å½“æ–‡ä»¶å†…å®¹ä¸­åŒ…å« `TARGET_BASE_URLS` ä¸­çš„ä»»æ„ URL æ—¶ï¼Œæ‰è¿›è¡Œ ModelScope å¯†é’¥æå–ã€‚

```python
def _contains_base_url(content: str, base_urls: List[str]) -> Tuple[bool, List[int]]:
    lc = content.lower()
    positions = []
    for url in base_urls:
        start = 0
        while True:
            idx = lc.find(url.lower(), start)
            if idx == -1:
                break
            positions.append(idx)
            start = idx + 1
    return (len(positions) > 0), positions
```

### 2. é‚»è¿‘æ€§è¿‡æ»¤ï¼ˆProximity Filterï¼‰

å½“å¯ç”¨å®½æ¾æ¨¡å¼æ—¶ï¼Œè¦æ±‚å¯†é’¥ä¸ base_url çš„å‡ºç°ä½ç½®åœ¨æŒ‡å®šå­—ç¬¦èŒƒå›´å†…ã€‚

```python
if proximity_chars and base_positions:
    pos = m.start()
    near = any(abs(pos - bp) <= proximity_chars for bp in base_positions)
    if not near:
        continue
```

### 3. ä¸Šä¸‹æ–‡å…³é”®è¯è¿‡æ»¤

æ£€æŸ¥å¯†é’¥å‘¨å›´ 80 ä¸ªå­—ç¬¦å†…æ˜¯å¦åŒ…å« `key`, `token`, `secret`, `authorization`, `api[-_ ]?key`, `openrouter` ç­‰å…³é”®è¯ã€‚

```python
ctx_re = re.compile(r"(key|token|secret|authorization|api[-_ ]?key|openrouter)", re.IGNORECASE)
snippet = content[start:end]
if not ctx_re.search(snippet):
    continue
```

### 4. å ä½ç¬¦è¿‡æ»¤

æ’é™¤æ˜æ˜¾æ— æ•ˆçš„å ä½ç¬¦å¯†é’¥ï¼Œå¦‚ï¼š
- `sk-or-v1-0000000000000000...`
- `YOUR_API_KEY`
- åŒ…å« "example" çš„å¯†é’¥

**æœ¬èŠ‚æ¥æº**  
- [app/hajimi_king.py](file://app/hajimi_king.py#L115-L148)

## æ–‡ä»¶ç®¡ç†ä¸æŒä¹…åŒ–

`file_manager.py` è´Ÿè´£æ‰€æœ‰æ–‡ä»¶æ“ä½œï¼ŒåŒ…æ‹¬ï¼š

- åŠ è½½æœç´¢æŸ¥è¯¢
- ç®¡ç†æ£€æŸ¥ç‚¹ï¼ˆcheckpointï¼‰
- ä¿å­˜å¯†é’¥ç»“æœ
- åŠ¨æ€æ–‡ä»¶åæ›´æ–°

### æ£€æŸ¥ç‚¹æœºåˆ¶

ä½¿ç”¨ `Checkpoint` æ•°æ®ç±»ç®¡ç†æ‰«æçŠ¶æ€ï¼š

```python
@dataclass
class Checkpoint:
    last_scan_time: Optional[str] = None
    scanned_shas: Set[str] = field(default_factory=set)
    processed_queries: Set[str] = field(default_factory=set)
    wait_send_balancer: Set[str] = field(default_factory=set)
    wait_send_gpt_load: Set[str] = field(default_factory=set)
```

æ”¯æŒå¢é‡æ‰«æï¼Œé¿å…é‡å¤å¤„ç†å·²æ‰«æçš„æ–‡ä»¶ï¼ˆé€šè¿‡ SHAï¼‰å’ŒæŸ¥è¯¢ã€‚

### ç»“æœæŒä¹…åŒ–

- æœ‰æ•ˆå¯†é’¥ï¼šä¿å­˜åˆ° `keys/keys_valid_YYYYMMDD.txt`
- é™æµå¯†é’¥ï¼šä¿å­˜åˆ° `keys/key_429_YYYYMMDD.txt`
- è¯¦ç»†æ—¥å¿—ï¼šåŒ…å«æ—¶é—´ã€URLã€å¯†é’¥çš„ `.log` æ–‡ä»¶
- å‘é€ç»“æœï¼šè®°å½•åŒæ­¥çŠ¶æ€

```mermaid
classDiagram
class Checkpoint {
+str last_scan_time
+Set[str] scanned_shas
+Set[str] processed_queries
+Set[str] wait_send_balancer
+Set[str] wait_send_gpt_load
+to_dict() Dict
+from_dict(data) Checkpoint
+add_scanned_sha(sha)
+add_processed_query(query)
+update_scan_time()
}
class FileManager {
+str data_dir
+str checkpoint_file
+str scanned_shas_file
+List[str] _search_queries
+load_checkpoint() Checkpoint
+load_scanned_shas() Set[str]
+load_search_queries(path) List[str]
+save_checkpoint(cp)
+save_scanned_shas(shas)
+save_valid_keys(repo, path, url, keys)
+save_rate_limited_keys(repo, path, url, keys)
+update_dynamic_filenames()
}
FileManager --> Checkpoint : "åŒ…å«"
```

**å›¾ç¤ºæ¥æº**  
- [utils/file_manager.py](file://utils/file_manager.py#L1-L492)

## æ•°æ®æµä¸å¤„ç†æµç¨‹

```mermaid
sequenceDiagram
participant Main as ä¸»ç¨‹åº
participant GitHub as GitHubå®¢æˆ·ç«¯
participant FileManager as æ–‡ä»¶ç®¡ç†å™¨
participant Extractor as å¯†é’¥æå–å™¨
participant Validator as å¯†é’¥éªŒè¯å™¨
Main->>FileManager : åˆå§‹åŒ–
Main->>FileManager : åŠ è½½æ£€æŸ¥ç‚¹
Main->>FileManager : åŠ è½½æœç´¢æŸ¥è¯¢
loop æ¯ä¸ªæŸ¥è¯¢
Main->>GitHub : search_for_keys(query)
GitHub-->>Main : è¿”å›æœç´¢ç»“æœ
loop æ¯ä¸ªç»“æœé¡¹
Main->>Main : should_skip_item?
alt åº”è·³è¿‡
Main->>Main : è®°å½•è·³è¿‡åŸå› 
else ä¸è·³è¿‡
Main->>GitHub : get_file_content(item)
GitHub-->>Main : æ–‡ä»¶å†…å®¹
Main->>Extractor : extract_ms_keys_for_modelscope(content)
alt æ‰¾åˆ°ModelScopeå¯†é’¥
Main->>FileManager : save_valid_keys(keys)
else æœªæ‰¾åˆ°
Main->>Extractor : extract_openrouter_keys(content)
alt æ‰¾åˆ°OpenRouterå¯†é’¥
Main->>FileManager : save_valid_keys(keys)
else æœªæ‰¾åˆ°
Main->>Extractor : extract_keys_from_content(content)
Main->>Validator : validate_gemini_key(key)
alt æœ‰æ•ˆ
Main->>FileManager : save_valid_keys(keys)
Main->>sync_utils : add_keys_to_queue(keys)
else é™æµ
Main->>FileManager : save_rate_limited_keys(keys)
end
end
end
Main->>Checkpoint : add_scanned_sha(sha)
end
end
Main->>FileManager : save_checkpoint(checkpoint)
end
```

**å›¾ç¤ºæ¥æº**  
- [app/hajimi_king.py](file://app/hajimi_king.py#L250-L523)
- [utils/file_manager.py](file://utils/file_manager.py#L1-L492)

## é…ç½®ç®¡ç†ä¸å¯æ‰©å±•æ€§

### é…ç½®é¡¹è¯´æ˜

| é…ç½®é¡¹ | è¯´æ˜ |
|-------|------|
| `GITHUB_TOKENS` | GitHub API è®¿é—®ä»¤ç‰Œ |
| `TARGET_BASE_URLS` | ModelScope API åœ°å€ |
| `MS_USE_LOOSE_PATTERN` | æ˜¯å¦å¯ç”¨å®½æ¾å¯†é’¥æ¨¡å¼ |
| `MS_PROXIMITY_CHARS` | å¯†é’¥ä¸ base_url çš„æœ€å¤§è·ç¦» |
| `MS_REQUIRE_KEY_CONTEXT` | æ˜¯å¦è¦æ±‚ä¸Šä¸‹æ–‡å…³é”®è¯ |
| `MODELSCOPE_EXTRACT_ONLY` | æ˜¯å¦ä»…æå– ModelScope å¯†é’¥ |
| `OPENROUTER_BASE_URLS` | OpenRouter API åœ°å€ |
| `OPENROUTER_USE_LOOSE_PATTERN` | æ˜¯å¦å¯ç”¨ OpenRouter å®½æ¾æ¨¡å¼ |
| `OPENROUTER_PROXIMITY_CHARS` | OpenRouter å¯†é’¥ä¸ base_url çš„æœ€å¤§è·ç¦» |
| `OPENROUTER_REQUIRE_KEY_CONTEXT` | æ˜¯å¦è¦æ±‚ OpenRouter ä¸Šä¸‹æ–‡å…³é”®è¯ |
| `OPENROUTER_EXTRACT_ONLY` | æ˜¯å¦ä»…æå– OpenRouter å¯†é’¥ |

### å¯æ‰©å±•æ€§è®¾è®¡

ç³»ç»Ÿæ”¯æŒé€šè¿‡ä¿®æ”¹æ­£åˆ™è¡¨è¾¾å¼å’Œé…ç½®æ¥æ·»åŠ æ–°å¹³å°æ”¯æŒã€‚ä¾‹å¦‚ï¼Œæ·»åŠ é˜¿é‡Œäº‘å¯†é’¥æ”¯æŒï¼š

```python
def extract_aliyun_keys(content: str) -> List[str]:
    pattern = r'LTAI[A-Za-z0-9]{20}'
    return re.findall(pattern, content)
```

ç„¶ååœ¨ `process_item` ä¸­è°ƒç”¨å³å¯ã€‚

**æœ¬èŠ‚æ¥æº**  
- [common/config.py](file://common/config.py#L1-L203)
- [app/hajimi_king.py](file://app/hajimi_king.py#L1-L523)

## é”™è¯¯å¤„ç†ä¸æ—¥å¿—è®°å½•

ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚é”™è¯¯å¤„ç†ï¼š

- `try-except` æ•è·ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™å¼‚å¸¸
- ä½¿ç”¨ `Logger` ç»Ÿä¸€è¾“å‡ºæ—¥å¿—
- ç»Ÿè®¡è·³è¿‡é¡¹åŸå› ï¼ˆæ—¶é—´ã€é‡å¤ã€å¹´é¾„ã€æ–‡æ¡£ï¼‰

æ—¥å¿—çº§åˆ«ï¼š
- `INFO`ï¼šå…³é”®æµç¨‹ã€ç»Ÿè®¡ä¿¡æ¯
- `WARNING`ï¼šå¯æ¢å¤é”™è¯¯ï¼ˆå¦‚è·å–å†…å®¹å¤±è´¥ï¼‰
- `ERROR`ï¼šä¸¥é‡é”™è¯¯ï¼ˆå¦‚é…ç½®ç¼ºå¤±ï¼‰

è·³è¿‡ç»Ÿè®¡ç¤ºä¾‹ï¼š
```
ğŸ“Š Skipped 123 items - Time: 50, Duplicate: 30, Age: 40, Docs: 3
```

**æœ¬èŠ‚æ¥æº**  
- [app/hajimi_king.py](file://app/hajimi_king.py#L200-L240)
- [common/Logger.py](file://common/Logger.py)

## æ€»ç»“ä¸å»ºè®®

`APIKEY-king` å®ç°äº†ä¸€ä¸ªé«˜æ•ˆã€å¯é…ç½®çš„å¯†é’¥æå–ç³»ç»Ÿï¼Œå…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äºï¼š

1. **ç²¾å‡†æå–**ï¼šç»“åˆæ­£åˆ™è¡¨è¾¾å¼ä¸ä¸Šä¸‹æ–‡éªŒè¯ï¼Œé™ä½è¯¯æŠ¥ç‡
2. **çµæ´»é…ç½®**ï¼šé€šè¿‡ç¯å¢ƒå˜é‡æ§åˆ¶è¡Œä¸ºï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
3. **æŒä¹…åŒ–å¯é **ï¼šæ”¯æŒæ–­ç‚¹ç»­ä¼ ä¸å¢é‡æ‰«æ
4. **æ˜“äºæ‰©å±•**ï¼šæ¨¡å—åŒ–è®¾è®¡ä¾¿äºæ·»åŠ æ–°å¹³å°æ”¯æŒ

### æ”¹è¿›å»ºè®®

1. **å¢åŠ å¯†é’¥æŒ‡çº¹è¯†åˆ«**ï¼šå¯¹å¯†é’¥è¿›è¡Œå“ˆå¸Œå­˜å‚¨ï¼Œé¿å…é‡å¤æŠ¥å‘Š
2. **æ”¯æŒæ›´å¤šå¹³å°**ï¼šå¦‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€AWS ç­‰
3. **å¢å¼ºä¸Šä¸‹æ–‡åˆ†æ**ï¼šä½¿ç”¨ NLP æŠ€æœ¯åˆ¤æ–­å¯†é’¥çœŸå®æ€§
4. **æä¾› Web ç•Œé¢**ï¼šå¯è§†åŒ–æ‰«æç»“æœä¸ç»Ÿè®¡ä¿¡æ¯

è¯¥ç³»ç»Ÿå¯å¹¿æ³›åº”ç”¨äºå®‰å…¨å®¡è®¡ã€å¯†é’¥æ³„éœ²ç›‘æ§ç­‰åœºæ™¯ã€‚

**æœ¬èŠ‚æ¥æº**  
- [app/hajimi_king.py](file://app/hajimi_king.py)
- [common/config.py](file://common/config.py)
- [utils/file_manager.py](file://utils/file_manager.py)