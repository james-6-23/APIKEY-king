# æœ¬åœ°éƒ¨ç½²

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**  
- [first_deploy.sh](file://first_deploy.sh)
- [pyproject.toml](file://pyproject.toml)
- [app/hajimi_king.py](file://app/hajimi_king.py)
- [Dockerfile](file://Dockerfile)
- [docker-compose.yml](file://docker-compose.yml)
- [common/config.py](file://common/config.py)
- [env.example](file://env.example)
</cite>

## ç›®å½•
1. [æœ¬åœ°éƒ¨ç½²](#æœ¬åœ°éƒ¨ç½²)
2. [è„šæœ¬éƒ¨ç½²æµç¨‹è¯¦è§£](#è„šæœ¬éƒ¨ç½²æµç¨‹è¯¦è§£)
3. [æ‰‹åŠ¨éƒ¨ç½²æ›¿ä»£æ–¹æ¡ˆ](#æ‰‹åŠ¨éƒ¨ç½²æ›¿ä»£æ–¹æ¡ˆ)
4. [é¦–æ¬¡è¿è¡ŒéªŒè¯](#é¦–æ¬¡è¿è¡ŒéªŒè¯)
5. [å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)

## æœ¬åœ°éƒ¨ç½²

æœ¬é¡¹ç›®æä¾›è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ `first_deploy.sh`ï¼Œç”¨äºåœ¨å¤–éƒ¨ç›®å½•ç‹¬ç«‹éƒ¨ç½² `hajimi-king` é¡¹ç›®ã€‚è¯¥è„šæœ¬é€šè¿‡ Docker å’Œ Docker Compose å®ç°ç¯å¢ƒéš”ç¦»ä¸æœåŠ¡ç¼–æ’ï¼Œç¡®ä¿éƒ¨ç½²è¿‡ç¨‹çš„ä¸€è‡´æ€§å’Œå¯é‡å¤æ€§ã€‚

éƒ¨ç½²æµç¨‹åŒ…æ‹¬ï¼šæºç ç›®å½•æ£€æŸ¥ã€Docker ç¯å¢ƒéªŒè¯ã€éƒ¨ç½²ç›®å½•ç»“æ„åˆå§‹åŒ–ã€GitHub Token é…ç½®ã€Docker é•œåƒæ„å»ºä¸æœåŠ¡å¯åŠ¨ã€‚æ•´ä¸ªè¿‡ç¨‹è‡ªåŠ¨åŒ–å®Œæˆï¼Œç”¨æˆ·åªéœ€æä¾› GitHub Personal Access Token å³å¯ã€‚

**Section sources**
- [first_deploy.sh](file://first_deploy.sh#L1-L275)
- [README.md](file://README.md#L1-L343)

## è„šæœ¬éƒ¨ç½²æµç¨‹è¯¦è§£

### éƒ¨ç½²è„šæœ¬åŠŸèƒ½æ¦‚è¿°

`first_deploy.sh` æ˜¯ä¸€ä¸ª Bash è„šæœ¬ï¼Œè´Ÿè´£å®Œæˆ `hajimi-king` é¡¹ç›®çš„å®Œæ•´éƒ¨ç½²æµç¨‹ã€‚å…¶ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

- æ£€æŸ¥æºç ç›®å½•å®Œæ•´æ€§
- éªŒè¯ Docker ç¯å¢ƒå¯ç”¨æ€§
- åˆå§‹åŒ–éƒ¨ç½²ç›®å½•ç»“æ„
- é…ç½® GitHub Token
- æ„å»º Docker é•œåƒ
- å¯åŠ¨ Docker Compose æœåŠ¡

```mermaid
flowchart TD
A[å¼€å§‹éƒ¨ç½²] --> B[æ‰“å°æ¨ªå¹…]
B --> C[æ£€æŸ¥æºç ç›®å½•]
C --> D[æ£€æŸ¥Dockerç¯å¢ƒ]
D --> E[è®¾ç½®éƒ¨ç½²ç›®å½•ç»“æ„]
E --> F[é…ç½®GitHub Token]
F --> G[æ¸…ç†ç°æœ‰å®¹å™¨]
G --> H[æ„å»ºDockeré•œåƒ]
H --> I[å¯åŠ¨æœåŠ¡]
I --> J[éƒ¨ç½²å®Œæˆ]
```

**Diagram sources**
- [first_deploy.sh](file://first_deploy.sh#L1-L275)

**Section sources**
- [first_deploy.sh](file://first_deploy.sh#L1-L275)

### ç¯å¢ƒåˆå§‹åŒ–ä¸é…ç½®è‡ªåŠ¨åŒ–

#### Pythonè™šæ‹Ÿç¯å¢ƒä¸ä¾èµ–ç®¡ç†

é¡¹ç›®ä½¿ç”¨ `uv` ä½œä¸ºåŒ…ç®¡ç†å™¨ï¼Œåœ¨ `Dockerfile` ä¸­å®ç°ä¾èµ–å®‰è£…ï¼š

```dockerfile
# å®‰è£…uvåŒ…ç®¡ç†å™¨
RUN pip install uv

# ä½¿ç”¨uvå®‰è£…Pythonä¾èµ–
RUN uv pip install --system --no-cache -r pyproject.toml
```

`pyproject.toml` æ–‡ä»¶å®šä¹‰äº†é¡¹ç›®ä¾èµ–ï¼š

```toml
[project]
requires-python = ">=3.11"
dependencies = [
    "google-generativeai>=0.8.5",
    "python-dotenv>=1.1.1",
    "requests>=2.32.4",
]
```

#### ç¯å¢ƒå˜é‡æ¨¡æ¿ç”Ÿæˆ

è„šæœ¬è‡ªåŠ¨å¤åˆ¶ `env.example` ä¸º `.env`ï¼Œå¹¶å¼•å¯¼ç”¨æˆ·è¾“å…¥ GitHub Tokenï¼š

```bash
# å¤åˆ¶env.exampleåˆ°å½“å‰ç›®å½•ä¸º.envï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
if [[ ! -f "${DEPLOY_DIR}/.env" ]]; then
    cp "${SOURCE_DIR}/env.example" "${DEPLOY_DIR}/.env"
    log_success "å¤åˆ¶é…ç½®æ–‡ä»¶: .env"
else
    log_info "é…ç½®æ–‡ä»¶å·²å­˜åœ¨: .env"
fi
```

`.env` æ–‡ä»¶åŒ…å«å…³é”®é…ç½®é¡¹ï¼š

- `GITHUB_TOKENS`: GitHub è®¿é—®ä»¤ç‰Œï¼ˆå¿…å¡«ï¼‰
- `PROXY`: ä»£ç†æœåŠ¡å™¨åœ°å€ï¼ˆå¯é€‰ï¼‰
- `DATE_RANGE_DAYS`: ä»“åº“å¹´é¾„è¿‡æ»¤å¤©æ•°
- `TARGET_BASE_URLS`: ModelScope æå–ç›®æ ‡URL

**Section sources**
- [Dockerfile](file://Dockerfile#L1-L27)
- [pyproject.toml](file://pyproject.toml#L1-L12)
- [env.example](file://env.example#L1-L49)

### æƒé™è®¾ç½®ä¸å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„é…ç½®

éƒ¨ç½²è„šæœ¬åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è‡ªåŠ¨å¤„ç†æ–‡ä»¶æƒé™å’Œè·¯å¾„é…ç½®ï¼š

- åˆ›å»º `data` ç›®å½•ç”¨äºæŒä¹…åŒ–å­˜å‚¨
- å¤åˆ¶ `queries.example` åˆ° `data/queries.txt`
- å¤åˆ¶ `docker-compose.yml` åˆ°éƒ¨ç½²ç›®å½•
- è®¾ç½®å®¹å™¨æŒ‚è½½å· `./data:/app/data`

Docker Compose é…ç½®å¦‚ä¸‹ï¼š

```yaml
version: '3.8'
services:
  hajimi-king:
    image: hajimi-king:0.0.1
    container_name: hajimi-king
    restart: unless-stopped
    network_mode: host
    env_file:
      - .env
    volumes:
      - ./data:/app/data
```

**Section sources**
- [first_deploy.sh](file://first_deploy.sh#L1-L275)
- [docker-compose.yml](file://docker-compose.yml#L1-L15)

## æ‰‹åŠ¨éƒ¨ç½²æ›¿ä»£æ–¹æ¡ˆ

å¯¹äºæ— æ³•è¿è¡Œè„šæœ¬çš„å—é™ç¯å¢ƒï¼Œå¯é‡‡ç”¨ä»¥ä¸‹æ‰‹åŠ¨éƒ¨ç½²æ­¥éª¤ï¼š

### ä¾èµ–é¡¹æ£€æŸ¥ä¸ç³»ç»Ÿå‡†å¤‡

1. **æ£€æŸ¥Pythonç‰ˆæœ¬**ï¼ˆ3.11+ï¼‰ï¼š
```bash
python --version
```

2. **å®‰è£…ç³»ç»Ÿå·¥å…·**ï¼š
```bash
# Ubuntu/Debian
sudo apt-get update && sudo apt-get install -y git curl docker docker-compose

# CentOS/RHEL
sudo yum install -y git curl docker docker-compose
```

3. **å®‰è£…uvåŒ…ç®¡ç†å™¨**ï¼š
```bash
pip install uv
```

### æ‰‹åŠ¨éƒ¨ç½²æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**ï¼š
```bash
git clone <repository-url>
cd APIKEY-king
```

2. **åˆ›å»ºéƒ¨ç½²ç›®å½•ç»“æ„**ï¼š
```bash
mkdir -p data
cp env.example .env
cp queries.example data/queries.txt
```

3. **é…ç½®ç¯å¢ƒå˜é‡**ï¼š
ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥ GitHub Tokenï¼š
```bash
GITHUB_TOKENS=ghp_your_token_here_1,ghp_your_token_here_2
```

4. **æ„å»ºå¹¶å¯åŠ¨æœåŠ¡**ï¼š
```bash
# æ„å»ºé•œåƒ
docker build -t hajimi-king:0.0.1 .

# å¯åŠ¨æœåŠ¡
docker-compose up -d
```

**Section sources**
- [README.md](file://README.md#L1-L343)
- [Dockerfile](file://Dockerfile#L1-L27)

## é¦–æ¬¡è¿è¡ŒéªŒè¯

### éªŒè¯å‘½ä»¤ç¤ºä¾‹

é¦–æ¬¡è¿è¡Œ `hajimi_king.py` å¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# å…¼å®¹æ¨¡å¼ï¼šæœªå‘½ä¸­ms-keyæ—¶å›é€€åˆ°Geminiæå–
python app/hajimi_king.py --mode compatible

# ä»…ModelScopeæ¨¡å¼ï¼šåªæå–åŒ…å«base_urlçš„ms-key
python app/hajimi_king.py --mode modelscope-only
```

### æ—¥å¿—è¾“å‡ºç¡®è®¤

æŸ¥çœ‹æ—¥å¿—ä»¥ç¡®è®¤éƒ¨ç½²æˆåŠŸï¼š

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æ£€æŸ¥ç”Ÿæˆçš„å¯†é’¥æ–‡ä»¶
ls data/keys/keys_valid_*.txt
cat data/keys/keys_valid_*.txt
```

æˆåŠŸéƒ¨ç½²çš„æ—¥å¿—ç‰¹å¾ï¼š
- æ˜¾ç¤º "ğŸš€ HAJIMI KING STARTING"
- é…ç½®æ£€æŸ¥é€šè¿‡ï¼ˆâœ… All required configurations are validï¼‰
- å¼€å§‹å¤„ç†æœç´¢æŸ¥è¯¢ï¼ˆğŸ”„ Loop #1ï¼‰
- æ‰¾åˆ°æœ‰æ•ˆå¯†é’¥ï¼ˆâœ… VALID: AIzaSy...ï¼‰

**Section sources**
- [app/hajimi_king.py](file://app/hajimi_king.py#L1-L523)
- [common/Logger.py](file://common/Logger.py#L1-L25)

## å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### æƒé™æ‹’ç»

**é—®é¢˜**ï¼š`Permission denied` é”™è¯¯  
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿ç”¨æˆ·åœ¨ `docker` ç”¨æˆ·ç»„ä¸­ï¼š
```bash
sudo usermod -aG docker $USER
```
2. é‡å¯ç»ˆç«¯æˆ–æ‰§è¡Œ `newgrp docker`

### ç½‘ç»œè¶…æ—¶

**é—®é¢˜**ï¼š`Connection timeout` æˆ– `Network unreachable`  
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. é…ç½®ä»£ç†ï¼š
```bash
# åœ¨.envä¸­æ·»åŠ 
PROXY=http://your-proxy:port
```
2. ä½¿ç”¨ WARP ä»£ç†ï¼š
```bash
PROXY=http://localhost:1080
```

### ä¾èµ–å†²çª

**é—®é¢˜**ï¼š`pip` å®‰è£…ä¾èµ–å†²çª  
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä½¿ç”¨ `uv` æ¸…ç†ç¼“å­˜ï¼š
```bash
uv cache clean
```
2. é‡æ–°å®‰è£…ä¾èµ–ï¼š
```bash
uv pip install --system --no-cache -r pyproject.toml
```

### GitHub Token æ— æ•ˆ

**é—®é¢˜**ï¼š`GitHub Token not found`  
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ Token æ ¼å¼ä»¥ `ghp_` å¼€å¤´
2. ç¡®ä¿ Token å…·æœ‰ `public_repo` æƒé™
3. åœ¨ [GitHub Settings > Tokens](https://github.com/settings/tokens) é‡æ–°ç”Ÿæˆ

### Docker æ„å»ºå¤±è´¥

**é—®é¢˜**ï¼š`docker build` å¤±è´¥  
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ¸…ç†æ„å»ºç¼“å­˜ï¼š
```bash
docker builder prune
```
2. æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œå¿…è¦æ—¶é…ç½® Docker ä»£ç†

**Section sources**
- [first_deploy.sh](file://first_deploy.sh#L1-L275)
- [common/config.py](file://common/config.py#L1-L203)
- [README.md](file://README.md#L1-L343)