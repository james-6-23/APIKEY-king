version: '3.8'

services:
  # ğŸš€ å…¨é¢éªŒè¯æ¨¡å¼ï¼ˆæ¨èï¼‰
  apikey-king-full:
    image: apikey-king:latest
    container_name: apikey-king-full
    restart: unless-stopped
    environment:
      - GITHUB_TOKENS=${GITHUB_TOKENS}
      - GEMINI_VALIDATION_ENABLED=true
      - OPENROUTER_VALIDATION_ENABLED=true
      - MODELSCOPE_VALIDATION_ENABLED=true
      - HAJIMI_CHECK_MODEL=gemini-2.5-flash
      - OPENROUTER_TEST_MODEL=deepseek/deepseek-chat-v3.1:free
      - MODELSCOPE_TEST_MODEL=Qwen/Qwen2-1.5B-Instruct
      - PROXY=${PROXY:-}
    volumes:
      - ./data/full:/app/data
      - ./config/queries:/app/config/queries:ro
    command: ["python", "-m", "src.main", "--mode", "compatible"]
    profiles: ["full", "all"]

  # ğŸ§  Gemini ä¸“æ‰«æ¨¡å¼
  apikey-king-gemini:
    image: apikey-king:latest
    container_name: apikey-king-gemini
    restart: unless-stopped
    environment:
      - GITHUB_TOKENS=${GITHUB_TOKENS}
      - GEMINI_VALIDATION_ENABLED=true
      - OPENROUTER_VALIDATION_ENABLED=false
      - MODELSCOPE_VALIDATION_ENABLED=false
      - HAJIMI_CHECK_MODEL=gemini-2.5-flash
      - PROXY=${PROXY:-}
    volumes:
      - ./data/gemini:/app/data
      - ./config/queries/gemini.txt:/app/data/queries.txt:ro
    command: ["python", "-m", "src.main", "--mode", "gemini-only"]
    profiles: ["gemini", "modes"]

  # ğŸš€ OpenRouter ä¸“æ‰«æ¨¡å¼  
  apikey-king-openrouter:
    image: apikey-king:latest
    container_name: apikey-king-openrouter
    restart: unless-stopped
    environment:
      - GITHUB_TOKENS=${GITHUB_TOKENS}
      - GEMINI_VALIDATION_ENABLED=false
      - OPENROUTER_VALIDATION_ENABLED=true
      - MODELSCOPE_VALIDATION_ENABLED=false
      - OPENROUTER_TEST_MODEL=deepseek/deepseek-chat-v3.1:free
      - PROXY=${PROXY:-}
    volumes:
      - ./data/openrouter:/app/data
      - ./config/queries/openrouter.txt:/app/data/queries.txt:ro
    command: ["python", "-m", "src.main", "--mode", "openrouter-only"]
    profiles: ["openrouter", "modes"]

  # ğŸ‡¨ğŸ‡³ ModelScope ä¸“æ‰«æ¨¡å¼
  apikey-king-modelscope:
    image: apikey-king:latest
    container_name: apikey-king-modelscope
    restart: unless-stopped
    environment:
      - GITHUB_TOKENS=${GITHUB_TOKENS}
      - GEMINI_VALIDATION_ENABLED=false
      - OPENROUTER_VALIDATION_ENABLED=false
      - MODELSCOPE_VALIDATION_ENABLED=true
      - MODELSCOPE_TEST_MODEL=Qwen/Qwen2-1.5B-Instruct
      - PROXY=${PROXY:-}
    volumes:
      - ./data/modelscope:/app/data
      - ./config/queries/modelscope.txt:/app/data/queries.txt:ro
    command: ["python", "-m", "src.main", "--mode", "modelscope-only"]
    profiles: ["modelscope", "modes"]

  # ğŸ“Š ç›‘æ§æœåŠ¡ï¼ˆå¯é€‰ï¼‰
  apikey-king-monitor:
    image: apikey-king:latest
    container_name: apikey-king-monitor
    restart: unless-stopped
    environment:
      - GITHUB_TOKENS=${GITHUB_TOKENS}
    volumes:
      - ./data:/app/data:ro
    command: ["tail", "-f", "/app/data/*/logs/keys_valid_detail_*.log"]
    profiles: ["monitor"]

# ç½‘ç»œé…ç½®
networks:
  default:
    driver: bridge

# æ•°æ®å·
volumes:
  data:
    driver: local